
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Real data &#8212; Tsdate manual</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5349f25f" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=9c3e77be" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=1ae7504c"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'real-data';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Population size" href="popsize.html" />
    <link rel="prev" title="Methods" href="methods.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <script data-goatcounter="https://tskit.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/tsdate_logo.svg" class="logo__image only-light" alt=""/>
    <script>document.write(`<img src="_static/tsdate_logo.svg" class="logo__image only-dark" alt=""/>`);</script>
  
  
    <p class="title logo__title">Version 0.2.5</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="usage.html">Usage</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="methods.html">Methods</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Real data</a></li>
<li class="toctree-l2"><a class="reference internal" href="popsize.html">Population size</a></li>
<li class="toctree-l2"><a class="reference internal" href="historical_samples.html">Historical (Ancient) Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="priors.html">More on priors (old)</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api.html">APIs</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="python-api.html">Python API</a></li>


<li class="toctree-l2"><a class="reference internal" href="cli.html">Command line interface</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="citation.html">Citation</a></li>
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">Changelog</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/real-data.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Real data</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing">Preprocessing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#continuous-time-considerations">Continuous time considerations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rescaling-details">Rescaling details</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discrete-time-considerations">Discrete time considerations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#numerical-stability">Numerical stability</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="real-data">
<span id="sec-real-data"></span><h1>Real data<a class="headerlink" href="#real-data" title="Link to this heading">#</a></h1>
<p>Real world data is likely to consist of larger datasets than in the <a class="reference internal" href="usage.html#sec-usage"><span class="std std-ref">Usage</span></a>
examples, and may exhibit issues that are not present in simulated data such as
<a class="reference internal" href="#sec-real-data-numerical-stability"><span class="std std-ref">numerical instability</span></a> and other problems.</p>
<p>In particular, two issues can have a large influence when dating tree sequences
inferred by tools such as <a class="reference external" href="https://tskit.dev/tsinfer/docs/stable/introduction.html#sec-introduction" title="(in Project name not set)"><span class="xref std std-ref">tsinfer</span></a>:</p>
<ol class="arabic simple">
<li><p>An inferred tree sequence may have too many edge constraints, for instance
if multiple ancestors in the true genealogy are wrongly combined into a
single node in the inferred tree sequence, or if a parent-child relationship
(i.e. an edge) is wrongly inferred between two nodes.</p></li>
<li><p>Inferred tree sequences may contain <em>polytomies</em> (multifurcations) indicating
uncertainty about the order of branching in the original genealogy. In this case,
it is possible to choose the polytomy date to represent either the oldest of the
contributing branch points, or the expected pairwise tMRCA between the lineages
contributing to the polytomy. The first provides a more accurate estimate of
both mutation dates and the date of nodes under each mutation. The second provides
a better estimate of coalescence times and edge areas / total branch lengths.</p></li>
</ol>
<p>Issue 1 can be ameliorated by fully simplifying the tree sequence, and breaking up
nodes (e.g. by splitting nodes into separate ancestors: see
<a class="reference internal" href="#sec-real-data-preprocessing"><span class="std std-ref">Preprocessing</span></a>). Using the default <code class="docutils literal notranslate"><span class="pre">variational_gamma</span></code> method,
issue 2 can be addressed during the rescaling step by explicitly setting <code class="docutils literal notranslate"><span class="pre">match_segregating_sites</span></code>
to either <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code> (see <a class="reference internal" href="#sec-real-data-rescaling"><span class="std std-ref">Rescaling details</span></a> below)</p>
<section id="preprocessing">
<span id="sec-real-data-preprocessing"></span><h2>Preprocessing<a class="headerlink" href="#preprocessing" title="Link to this heading">#</a></h2>
<p>For real datasets, you are advised to run <a class="reference internal" href="python-api.html#tsdate.preprocess_ts" title="tsdate.preprocess_ts"><code class="xref py py-func docutils literal notranslate"><span class="pre">preprocess_ts()</span></code></a> on your inferred tree
sequence before dating. This removes regions with no variable sites, simplifies the
tree sequence to remove locally unary portions of nodes, and splits disjoint nodes into
separate datable nodes. Not only can this improve the accuracy of dating, but it
also increases <a class="reference internal" href="#sec-real-data-numerical-stability"><span class="std std-ref">Numerical stability</span></a>. See the documentation for
<a class="reference internal" href="python-api.html#tsdate.preprocess_ts" title="tsdate.preprocess_ts"><code class="xref py py-func docutils literal notranslate"><span class="pre">tsdate.preprocess_ts()</span></code></a> for details on how to increase or decrease its stringency.</p>
<p>In particular, the <code class="docutils literal notranslate"><span class="pre">tsinfer</span></code> algorithm can overestimate the span of genome
covered by some nodes, especially those at ancient times. This is particularly
seen when nodes contain “locally unary” sections (i.e. where the node only has
one child in some trees), or where a node is “disjoint”, disappearing from one tree
to reappear in a tree in a more distant region of the genome. This extended node
span can cause problems by tying together distant parts of the genealogy. Preprocessing
removes locally unary sections of nodes via simplification, and splits disjoint nodes
using the <a class="reference internal" href="python-api.html#tsdate.util.split_disjoint_nodes" title="tsdate.util.split_disjoint_nodes"><code class="xref py py-func docutils literal notranslate"><span class="pre">tsdate.util.split_disjoint_nodes()</span></code></a> functionality.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If unary regions are <em>correctly</em> estimated, they can help improve dating slightly.
You can set the <code class="docutils literal notranslate"><span class="pre">allow_unary=True</span></code> option to run tsdate on such tree sequences.</p>
</div>
</section>
<section id="continuous-time-considerations">
<h2>Continuous time considerations<a class="headerlink" href="#continuous-time-considerations" title="Link to this heading">#</a></h2>
<p>In general, when analysing real data with <em>tsdate</em>, we recommended using
the default <a class="reference internal" href="python-api.html#tsdate.variational_gamma" title="tsdate.variational_gamma"><code class="xref py py-func docutils literal notranslate"><span class="pre">tsdate.variational_gamma()</span></code></a> <a class="reference internal" href="methods.html#sec-methods"><span class="std std-ref">method</span></a>. This
has several parameters which can be adjusted. The <code class="docutils literal notranslate"><span class="pre">max_iterations</span></code> parameter simply
adjusts the number of rounds of <a class="reference internal" href="methods.html#sec-methods-expectation-propagation"><span class="std std-ref">Expectation propagation</span></a>, and
is usually sufficiently large to give reasonable results on real data. The
other parameters concern rescaling.</p>
<section id="rescaling-details">
<span id="sec-real-data-rescaling"></span><h3>Rescaling details<a class="headerlink" href="#rescaling-details" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Tsdate</span></code> uses a modified version of the rescaling algorithm introduced in
<a class="reference external" href="https://github.com/popgenmethods/SINGER">SINGER</a> <span id="id1">[<a class="reference internal" href="bibliography.html#id8" title="Yun Deng, Rasmus Nielsen, and Yun S. Song. Robust and accurate Bayesian inference of genome-wide genealogies for large samples. bioRxiv, 2024. doi:10.1101/2024.03.16.585351.">Deng <em>et al.</em>, 2024</a>]</span>
that works on gamma natural parameters rather than point estimates.
Rescaling can help to deal with the effects of variable population size
though time (see <a class="reference internal" href="popsize.html#sec-popsize"><span class="std std-ref">Population size</span></a>). Currently, three parameters can be set:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">match_segregating_sites</span></code>. This has the largest effect if tree sequences contain
polytomies.</p>
<ol class="arabic simple">
<li><p>When explicitly set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, times within intervals are scaled such that the
average mutational distance between pairs of samples best matches the mutation rate.
This is similar to the approach in SINGER, and is appropriate if, for example,
you are interested in estimating coalescence rates over time, or average
divergent times (MRCAs) between samples. In the resulting dated tree sequence,
polytomy dates will correspond to the average distance between the pairs of
lineages contributing to the polytomy.</p></li>
<li><p>By default, <code class="docutils literal notranslate"><span class="pre">match_segregating_sites=False</span></code>, meaning that times within intervals
are simultaneously scaled such that the expected density of mutations along each
path from a sample to the root best matches the mutational density predicted
from the user-provided mutation rate. This is most suitable if you wish to estimate
dates of mutations or dates of identifiable common ancestors. In the resulting
dated tree sequence, polytomy dates will correspond to the oldest ancestor that
contributes to the polytomy.</p></li>
</ol>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">rescaling_intervals</span></code>. This sets the number of time intervals over which rescaling
takes place. To turn off rescaling entirely, a value of <code class="docutils literal notranslate"><span class="pre">0</span></code> can be provided;
however, resulting dates may be less accurately estimated if the dataset comes
from a set of samples with a complex demographic history (see <a class="reference internal" href="popsize.html#sec-popsize"><span class="std std-ref">Population size</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rescaling_iterations</span></code>: several rounds of rescaling are carried out. Normally very
few iterations are required to reach a stable set of rescaled intervals.</p></li>
</ul>
<div class="admonition-todo admonition" id="id2">
<p class="admonition-title">Todo</p>
<p>Describe the rescaling step in more detail. Could also link to <a class="reference internal" href="popsize.html#sec-popsize"><span class="std std-ref">the population size docs</span></a></p>
</div>
</section>
</section>
<section id="discrete-time-considerations">
<h2>Discrete time considerations<a class="headerlink" href="#discrete-time-considerations" title="Link to this heading">#</a></h2>
<p>A few parameters can be set to speed up discrete-time methods.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For <a class="reference internal" href="methods.html#sec-methods-discrete-time"><span class="std std-ref">Discrete-time</span></a> methods, <em>tsdate</em> scales
quadratically in the number of time slices. To increase speed or temporal resolution,
you are thus advised to keep with the <a class="reference internal" href="methods.html#sec-methods-continuous-time"><span class="std std-ref">Continuous-time</span></a>
<code class="docutils literal notranslate"><span class="pre">variational_gamma</span></code> method.</p>
</div>
<p>For discrete-time methods, before the dating algorithm is run the conditional
coalescent prior distribution must be calculated for each node.
Although this is roughly linear in the number of nodes,
it can still take some time if there are millions of nodes.
To speed up this process an approximation to the conditional coalescent
is used for nodes which have a large number of descendants
(the exact number can be modified by <a class="reference internal" href="priors.html#sec-priors-timegrid"><span class="std std-ref">making a prior</span></a>
using the <code class="docutils literal notranslate"><span class="pre">approx_prior_size</span></code> parameter).
The results of this approximation are cached, so that <em>tsdate</em> will run slightly faster
the second time it is run.</p>
<p>Regularly reused mutational likelihoods are precalculated in the dicrete-time methods.
This precalculation can be parallelised by specifying the <code class="docutils literal notranslate"><span class="pre">num_threads</span></code> parameter to
<a class="reference internal" href="python-api.html#tsdate.inside_outside" title="tsdate.inside_outside"><code class="xref py py-func docutils literal notranslate"><span class="pre">tsdate.inside_outside()</span></code></a> and <a class="reference internal" href="python-api.html#tsdate.maximization" title="tsdate.maximization"><code class="xref py py-func docutils literal notranslate"><span class="pre">tsdate.maximization()</span></code></a>. However, this
behaviour is subject to change in future versions.</p>
</section>
<section id="numerical-stability">
<span id="sec-real-data-numerical-stability"></span><h2>Numerical stability<a class="headerlink" href="#numerical-stability" title="Link to this heading">#</a></h2>
<p>When passing messages between nodes, it is possible that the node time updates are
wildly incompatible with each other, for instance if a focal node is simultaneoulsy
attached to one small edge with many mutations and another large edge with few
mutations. The <code class="docutils literal notranslate"><span class="pre">variational_gamma</span></code> method incorporates a form of “damping” which
encourages gradual convergence to reasonable node times, but it may still be the case
that the tree sequence topology contains, for example, long deep branches with very few mutations, such as samples attaching directly to a local root.</p>
<p>Such “bad” tree sequences (caused by pathological combinations of topologies and
mutations) can result in <em>tsdate</em> raising an error when dating. Issues of this
nature are collected in
<a class="reference external" href="https://github.com/tskit-dev/tsdate/issues?q=label%3A%22numerical%20stability%22">this set of GitHub issues</a>.
They can often be fixed by removing bad regions of the tree sequence,
e.g. regions that have no variation because they are unmappable or have been
removed by a QC filter, such as at the centromere. <a class="reference internal" href="#sec-real-data-preprocessing"><span class="std std-ref">Preprocessing</span></a>
the tree sequence can remove such regions, as well
as cutting ties between nodes by removing locally unary regions and
splitting disjoint nodes, which can also cause stability problems.</p>
<p>If numerical issues still persist, this is likely to be a sign that the
tree sequence topology has been poorly inferred, and you are encouraged
to examine it in detail before proceeding. Running the
<a class="reference internal" href="python-api.html#tsdate.maximization" title="tsdate.maximization"><code class="xref py py-func docutils literal notranslate"><span class="pre">tsdate.maximization()</span></code></a> method should always work, but may not give
accurate results.</p>
<p>It is also possible for <em>tsdate</em> to have issues when
<a class="reference internal" href="#sec-real-data-rescaling"><span class="std std-ref">rescaling</span></a>, e.g. if there is not enough
information within a rescaling interval. Setting the <code class="docutils literal notranslate"><span class="pre">rescaling_intervals</span></code>
parameter to a smaller value, or omitting rescaling entirely, should
allow <em>tsdate</em> to run to completion.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="methods.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Methods</p>
      </div>
    </a>
    <a class="right-next"
       href="popsize.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Population size</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preprocessing">Preprocessing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#continuous-time-considerations">Continuous time considerations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rescaling-details">Rescaling details</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discrete-time-considerations">Discrete time considerations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#numerical-stability">Numerical stability</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Tskit Developers
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>