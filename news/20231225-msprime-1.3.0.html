<!DOCTYPE html>
<html lang="en-GB">

<!-- START: html-header -->
<head>
    
    <meta charset="utf-8">
    <meta name=”robots” content="index, follow">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>
        tskit-dev - Msprime 1.3.0!
    </title>
    <meta property="og:type" content="website">
    <meta content="summary_large_image" name="twitter:card">
    <meta content="" name="description">
    <meta content="Msprime 1.3.0 introduces the ability to record specific node types as well as edges 
for coalescing nodes along non-coalescing segments.
" property="og:description">
    <meta content="Msprime 1.3.0 introduces the ability to record specific node types as well as edges 
for coalescing nodes along non-coalescing segments.
" property="twitter:description">
    
        <meta content="https://i.imgur.com/I9PBjvU.png" property="og:image">
        <meta content="https://i.imgur.com/I9PBjvU.png" property="twitter:image">
    

    <meta content="tskit-dev - Msprime 1.3.0!" property="og:title">
    <meta content="tskit-dev - Msprime 1.3.0!" property="twitter:title">
    <script>
      document.documentElement.className = 'js'
    </script>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="profile" href="http://gmpg.org/xfn/11">

    <link rel="shortcut icon" href="/assets/favicons/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png">
    <link rel="manifest" href="/assets/favicons/site.webmanifest" crossorigin="use-credentials">
    <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.png" color="#085167">
    <meta name="msapplication-TileColor" content="#085167">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" href="https://use.typekit.net/uhf4ono.css">
    <link rel="stylesheet" href="/assets/dist/css/style.min.css">
<script data-goatcounter="https://tskit.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</head>
<!-- END: html-header -->

<body>
<div class="page-wrapper">
    <!-- START: header -->
    <header class="header">
        <!-- START: navbar -->
        <nav class="nav navbar navbar-expand-lg">
    <div class="container">
        <a class="navbar-brand" href="/">
            <!-- START: icon-logo -->
            <svg class="icon icon--logo" xmlns="http://www.w3.org/2000/svg" x="0" y="0" viewBox="0 0 84.8 68">
                <style>
                    .logo-st0 {
                        fill: #085167
                    }

                    .logo-st1 {
                        fill: #14e2a8
                    }
                </style>
                <path class="logo-st0"
                      d="M2 61.4v-8.2H0v-3.4h2v-5h4.8v5h5v3.4h-5v8.2c0 1.9.8 2.9 2.5 2.9.9 0 1.7-.2 2.4-.6v3.5c-1.1.5-2.4.8-3.7.8-4.2 0-6-2.8-6-6.6"></path>
                <path class="logo-st0"
                      d="M62.7 67.5v-3.4h1.9V53.2h-1.9v-3.4h6.8v14.3h1.9v3.4h-8.7zm1.1-23.3c-.1-1.6 1.2-2.9 2.7-3 1.6-.1 2.9 1.2 3 2.7.1 1.6-1.2 2.9-2.7 3h-.1c-1.5.1-2.8-1-2.9-2.5v-.2"></path>
                <path class="logo-st0"
                      d="M39.6 67.5v-3.4h1.9V45.4h-1.9V42h6.8v14.4h4l1.7-3.2h-2.5v-3.4h9.6v3.4h-2.6L53.7 58l4.2 6h2.8v3.4h-9.9V64h1.7l-2.8-4.6h-3.4V64h1.9v3.4l-8.6.1z"></path>
                <path class="logo-st0"
                      d="M23.4 57c4.5 1.3 6.4 2.7 6.4 5.9 0 3.3-2.5 5.1-6.4 5.1-2.6 0-4.3-.7-5.4-1.9l-.1 1.3h-3.4v-6.1h3.7c.7 1.9 2.5 3.2 4.5 3.1 1.3 0 2.3-.5 2.3-1.6s-1-1.5-1.7-1.7l-2.6-.7c-2.8-.7-6.2-1.7-6.2-6 0-3.4 2.4-5.2 6-5.2 1.8 0 3.6.6 5 1.8l.1-1.3H29v5.9h-3.7c-.4-1.7-1.9-2.9-3.6-2.9-1.3 0-2.3.5-2.3 1.7 0 1 .6 1.4 1.8 1.7l2.2.9z"></path>
                <path class="logo-st0"
                      d="M75 61.4v-8.2h-2v-3.4h2v-5h4.8v5h5v3.4h-5v8.2c0 1.9.8 2.9 2.5 2.9.9 0 1.7-.2 2.4-.6v3.5c-1.1.5-2.4.8-3.7.8-4.2 0-6-2.8-6-6.6"></path>
                <path class="logo-st1" d="M75 28.8h4.8v12.5H75z"></path>
                <path class="logo-st1" d="M41.5 28.8h4.8v9.6h-4.8z"></path>
                <path class="logo-st1" d="M41.5 24h38.3v4.8H41.5z"></path>
                <path class="logo-st1" d="M58.3 14.4h4.8V24h-4.8z"></path>
                <path class="logo-st1" d="M2 14.4h4.8v26.9H2z"></path>
                <path class="logo-st1" d="M2 9.6h61.1v4.8H2z"></path>
                <path class="logo-st1" d="M34.6 0h4.8v9.6h-4.8z"></path>
            </svg>
            <!-- END: icon-logo -->
            <span class="visually-hidden">
                        tskit
                    </span>
        </a>
        <button class="navbar-toggler collapsed"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#navbarContent"
                aria-controls="navbarContent"
                aria-expanded="false"
                aria-label="Toggle navigation"
        >
            <span class="navbar-toggler-icon"></span>
            <span class="navbar-toggler-icon"></span>
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarContent">
            <!-- START: menu -->
            <ul class="navbar-nav">
                <li class="nav__item">
                    <a href="/genetics-research" class=" nav__item__link">Genetics research</a>
                </li>
                <li class="nav__item">
                    <a href="/learn" class=" nav__item__link">Learn</a>
                </li>
                <li class="nav__item">
                    <a href="/software" class=" nav__item__link">Software</a>
                </li>
                <li class="nav__item">
                    <a href="/news" class=" nav__item__link">News</a>
                </li>
                <li class="nav__item">
                    <a href="/citation" class=" nav__item__link">Citation</a>
                </li>
                <li class="nav__item">
                    <a href="/community" class=" nav__item__link">Community</a>
                </li>
            </ul>
            <!-- END: menu -->
        </div>
    </div>
</nav>
        <!-- END: navbar -->

        <!-- START: heading -->
        
        <!-- END: heading -->
    </header>
    <!-- END: header -->

    <!-- START: content -->
    <main class="page-content" id="content">
        <!-- START: hero-type-2 -->
<div class="hero hero--type-2">
    <div class="container">
        <div class="row">
            <!-- NOTE: Different column values here than other instances of Type 2 Hero -->
            <div class="col-md-8 col-lg-8">
                <!-- NOTE: H1 here not H2 -->
                <h1 class="hero__heading">
                    Msprime 1.3.0!
                </h1>
                <span class="hero__metadata">
                    
                        <span class="hero__metadata__heading">Gertjan Bisschop</span>
                        &nbsp;|&nbsp;
                    
                            <time class="hero__metadate__timestamp" datetime="">December 25 2023</time>
                        </span>
            </div>
        </div>
    </div>
</div>
<!-- END: hero-type-2 -->

<!-- START: news-content -->
<section class="section section--general-content">
    <div class="container">
        <div class="row">
            <div class="col-md-8 offset-md-2 blog-entry">
                <h1 id="msprime-130">Msprime 1.3.0</h1>

<p>Msprime 1.3.0 introduces a new flexible way to store information on the ancestors associated with a custom subset of 
all possible events that might happen in the history of a sample. This means we can now simulate tree sequences 
with varying degrees of detail ranging from the default fully simplified series of local trees 
all the way to recording a fully detailed history as currently enabled by the <code class="highlighter-rouge">record_full_arg</code> flag.
This new feature has been implemented for all ancestry models implemented in msprime. 
Lastly, this new release enables the simulation of microsatellite repeats. This last feature builds on the existing<br />
general <code class="highlighter-rouge">MatrixMutationModel</code> class to represent the evolution of alleles containing a certain number of repeats.</p>

<h2 id="brief-summary-of-changes">Brief summary of changes</h2>

<h3 id="1-additional-nodes">1. Additional nodes</h3>

<p>In msprime we usually want to simulate the coalescent with recombination and represent the output as 
simply as possible. As a result, we don’t store individual recombination events, but rather their 
effects on the output tree sequence. We also do not explicitly store common ancestor events that do not 
result in marginal coalescences. For some purposes, however, we want record information on other events 
of interest, not just the mimimal representation of its outcome.</p>

<p>The newly implemented <code class="highlighter-rouge">additional_nodes</code> API serves this exact purpose. This allows us to record the nodes 
associated with a custom subset of all events we might observe in the history of a sample. Besides sampled 
genomes and coalescence events, nodes can now also represent common ancestors, as well as ancestors associated 
with recombination, gene conversion, migration, and pass through events.</p>

<p>The code below contains a small working example on how to specify this custom subset of node types. Because 
a single node can be involved in multiple types of events bitwise operations on the node flags 
are used to encode the various possibilities.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">msprime</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="n">ts</span> <span class="o">=</span> <span class="n">msprime</span><span class="p">.</span><span class="n">sim_ancestry</span><span class="p">(</span>
    <span class="n">samples</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">recombination_rate</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
    <span class="n">population_size</span><span class="o">=</span><span class="mf">1e4</span><span class="p">,</span>
    <span class="n">sequence_length</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span>
    <span class="n">random_seed</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span>
    <span class="n">additional_nodes</span><span class="o">=</span><span class="p">(</span>
         <span class="n">msprime</span><span class="p">.</span><span class="n">NodeType</span><span class="p">.</span><span class="n">RECOMBINANT</span> <span class="o">|</span>
         <span class="n">msprime</span><span class="p">.</span><span class="n">NodeType</span><span class="p">.</span><span class="n">COMMON_ANCESTOR</span>
         <span class="p">),</span>
    <span class="n">coalescing_segments_only</span><span class="o">=</span><span class="bp">False</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">count_flags</span><span class="p">(</span><span class="n">ts</span><span class="p">):</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">nodetype</span> <span class="ow">in</span> <span class="n">msprime</span><span class="p">.</span><span class="n">NodeType</span><span class="p">:</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">nodes_flags</span><span class="p">,</span> <span class="n">nodetype</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">counter</span><span class="p">[</span><span class="n">nodetype</span><span class="p">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">flags</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">counter</span>

<span class="k">print</span><span class="p">(</span><span class="n">count_flags</span><span class="p">(</span><span class="n">ts</span><span class="p">))</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{'RECOMBINANT': 388, 'COMMON_ANCESTOR': 107, 'MIGRANT': 0, 'CENSUS': 0, 'GENE_CONVERSION': 0, 'PASS_THROUGH': 0}    
</code></pre></div></div>

<h3 id="2-microsat-mutation-model">2. Microsat mutation model</h3>

<p>We have implemented a number of mutational models that are commonly used to model the evolution of microsatellite repeats. 
The basic idea here is that the number of copies of a given repeat is tracked, and its evolution over time subject to one 
of a number of potential biases. The alleles in MicrosatMutationModels represent the copy number of the repeat, 
not the actual sequences observed.</p>

<p>The example below shows how to simulate microsat repeats under the Stepwise Mutation Model (Ohta and Kimura, 1978).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ts</span> <span class="o">=</span> <span class="n">msprime</span><span class="p">.</span><span class="n">sim_ancestry</span><span class="p">(</span>
    <span class="mi">5</span><span class="p">,</span> 
    <span class="n">random_seed</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
    <span class="n">sequence_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">recombination_rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> 
    <span class="n">population_size</span><span class="o">=</span><span class="mi">100_000</span>
<span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">msprime</span><span class="p">.</span><span class="n">SMM</span><span class="p">(</span><span class="n">lo</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">hi</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">mts</span> <span class="o">=</span> <span class="n">msprime</span><span class="p">.</span><span class="n">sim_mutations</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="mf">5e-7</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">mts</span><span class="p">.</span><span class="n">variants</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Site at:"</span><span class="p">,</span> <span class="n">var</span><span class="p">.</span><span class="n">site</span><span class="p">.</span><span class="n">position</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"    Alleles:"</span><span class="p">,</span> <span class="n">var</span><span class="p">.</span><span class="n">alleles</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"    Genotypes:"</span><span class="p">,</span> <span class="n">var</span><span class="p">.</span><span class="n">genotypes</span><span class="p">)</span>
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Site at: 4.0
    Alleles: ('4', '5', '6')
    Genotypes: [1 1 1 1 1 2 2 1 1 0]
Site at: 8.0
    Alleles: ('6', '5')
    Genotypes: [0 1 1 1 1 1 1 1 1 0]
Site at: 9.0
    Alleles: ('10', '9')
    Genotypes: [0 1 0 0 1 0 0 0 0 0]
Site at: 11.0
    Alleles: ('7', '8')
    Genotypes: [1 1 0 0 0 0 0 0 0 1]
Site at: 13.0
    Alleles: ('4', '3')
    Genotypes: [1 0 0 0 0 0 1 1 1 0]
Site at: 15.0
    Alleles: ('7', '6')
    Genotypes: [0 1 1 0 1 0 1 0 1 0]
Site at: 17.0
    Alleles: ('6', '5', '7', '8')
    Genotypes: [3 3 1 3 1 3 1 3 3 1]
Site at: 19.0
    Alleles: ('10', '9')
    Genotypes: [0 1 0 0 1 0 1 0 0 0]
</code></pre></div></div>

<h1 id="feedback-etc">Feedback etc</h1>

<p>Please post a discussion or an issue on the <code class="highlighter-rouge">msprime</code> <a href="https://github.com/tskit-dev/msprime">GitHub repository</a> 
if you have any problems. We hope the update to <code class="highlighter-rouge">msprime</code> version 1.3 is useful in your research.</p>

            </div>
        </div>
    </div>
</section>
<!-- END: news-content -->

    </main>
    <!-- END: content -->

    <!-- START: footer -->
        <footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-5 offset-md-1">
                <a class="footer__logo" href="./">
                    <!-- START: icon-logo -->
                    <svg class="icon icon--logo" xmlns="http://www.w3.org/2000/svg" x="0" y="0"
                         viewBox="0 0 84.8 68">
                        <style>
                            .logo-st0 {
                                fill: #085167
                            }

                            .logo-st1 {
                                fill: #14e2a8
                            }
                        </style>
                        <path class="logo-st0"
                              d="M2 61.4v-8.2H0v-3.4h2v-5h4.8v5h5v3.4h-5v8.2c0 1.9.8 2.9 2.5 2.9.9 0 1.7-.2 2.4-.6v3.5c-1.1.5-2.4.8-3.7.8-4.2 0-6-2.8-6-6.6"></path>
                        <path class="logo-st0"
                              d="M62.7 67.5v-3.4h1.9V53.2h-1.9v-3.4h6.8v14.3h1.9v3.4h-8.7zm1.1-23.3c-.1-1.6 1.2-2.9 2.7-3 1.6-.1 2.9 1.2 3 2.7.1 1.6-1.2 2.9-2.7 3h-.1c-1.5.1-2.8-1-2.9-2.5v-.2"></path>
                        <path class="logo-st0"
                              d="M39.6 67.5v-3.4h1.9V45.4h-1.9V42h6.8v14.4h4l1.7-3.2h-2.5v-3.4h9.6v3.4h-2.6L53.7 58l4.2 6h2.8v3.4h-9.9V64h1.7l-2.8-4.6h-3.4V64h1.9v3.4l-8.6.1z"></path>
                        <path class="logo-st0"
                              d="M23.4 57c4.5 1.3 6.4 2.7 6.4 5.9 0 3.3-2.5 5.1-6.4 5.1-2.6 0-4.3-.7-5.4-1.9l-.1 1.3h-3.4v-6.1h3.7c.7 1.9 2.5 3.2 4.5 3.1 1.3 0 2.3-.5 2.3-1.6s-1-1.5-1.7-1.7l-2.6-.7c-2.8-.7-6.2-1.7-6.2-6 0-3.4 2.4-5.2 6-5.2 1.8 0 3.6.6 5 1.8l.1-1.3H29v5.9h-3.7c-.4-1.7-1.9-2.9-3.6-2.9-1.3 0-2.3.5-2.3 1.7 0 1 .6 1.4 1.8 1.7l2.2.9z"></path>
                        <path class="logo-st0"
                              d="M75 61.4v-8.2h-2v-3.4h2v-5h4.8v5h5v3.4h-5v8.2c0 1.9.8 2.9 2.5 2.9.9 0 1.7-.2 2.4-.6v3.5c-1.1.5-2.4.8-3.7.8-4.2 0-6-2.8-6-6.6"></path>
                        <path class="logo-st1" d="M75 28.8h4.8v12.5H75z"></path>
                        <path class="logo-st1" d="M41.5 28.8h4.8v9.6h-4.8z"></path>
                        <path class="logo-st1" d="M41.5 24h38.3v4.8H41.5z"></path>
                        <path class="logo-st1" d="M58.3 14.4h4.8V24h-4.8z"></path>
                        <path class="logo-st1" d="M2 14.4h4.8v26.9H2z"></path>
                        <path class="logo-st1" d="M2 9.6h61.1v4.8H2z"></path>
                        <path class="logo-st1" d="M34.6 0h4.8v9.6h-4.8z"></path>
                    </svg>
                    <!-- END: icon-logo -->
                    <span class="visually-hidden">
                        tskit
                    </span>
                </a>
            </div>
            <div class="col">
                <ul class="list list--unstyled">
                    <li class="list__item">
                        <a href="https://github.com/tskit-dev/tskit-site/issues/new/choose" class="list__item__link link link--type-1">
                                <span class="link__text">
                                    Report a website issue
                                </span>
                        </a>
                    </li>
                    <li class="list__item">
                        <a href="https://github.com/tskit-dev" class="list__item__link link link--type-1">
                                <span class="link__text">
                                    Github
                                </span>
                        </a>
                    </li>
                    <li class="list__item">
                        <a href="https://github.com/tskit-dev/.github/blob/main/CODE_OF_CONDUCT.md" class="list__item__link link link--type-1">
                                <span class="link__text">
                                    Code of conduct
                                </span>
                        </a>
                    </li>
                    <li class="list__item">
                        <a href="/governance/" class="list__item__link link link--type-1">
                                <span class="link__text">
                                    Governance
                                </span>
                        </a>
                    </li>
                    <li class="list__item">
                        <a href="https://github.com/tskit-dev/tskit-site/blob/main/LICENSE" class="list__item__link link link--type-1">
                                <span class="link__text">
                                    Licence
                                </span>
                        </a>
                    </li>
                    <li class="list__item">
                        <a href="/ecosystem-status/" class="list__item__link link link--type-1">
                                <span class="link__text">
                                    Ecosystem Status
                                </span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>

    <!-- END: footer -->
    <!-- START: global modal -->
    <div class="modal fade"
         id="globalModal"
         tabindex="-1"
         role="dialog"
         aria-labelledby="globalModalLabel"
         aria-hidden="true"
    >
        <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
            <div class="modal-content">
                <button class="navbar-toggler modal-close" type="button" data-bs-dismiss="modal" aria-label="Close">
                    <span class="navbar-toggler-icon"></span>
                    <span class="navbar-toggler-icon"></span>
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="modal-header visually-hidden">
                    <h5 class="modal-title" id="globalModalLabel">
                        Modal content
                    </h5>
                </div>
                <div class="modal-body"></div>
            </div>
        </div>
    </div>
    <!-- END: global modal -->

</div>

<script src="/assets/dist/js/main.min.js"></script>

</body>
</html>

