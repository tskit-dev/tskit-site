
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Time units &#8212; PySLiM manual</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'time_units';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Metadata" href="metadata.html" />
    <link rel="prev" title="Vignette: Parallelizing SLiM simulations in a phylogenetic tree" href="vignette_parallel_phylo.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <script data-goatcounter="https://tskit.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="introduction.html">
  
  
  
  
  
  
    <p class="title logo__title">PySLiM manual</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>

<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Using pyslim</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="vignette_space.html">Vignette: A spatial simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="vignette_continuing.html">Vignette: Following up with more coalescent simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="vignette_coalescent_diversity.html">Vignette: Starting with diversity generated by coalescent simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="vignette_parallel_phylo.html">Vignette: Parallelizing SLiM simulations in a phylogenetic tree</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Time units</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="previous_versions.html">Migrating from previous versions of pyslim</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">pyslim reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="python_api.html">Python API</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="development.html">Development</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/time_units.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Time units</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#that-warning-from-recapitate-about-time-units">That warning from recapitate about time units</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mutation-rates-with-msprime">Mutation rates with msprime</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#coalescence-recombination-and-migration-rates-in-recapitation">Coalescence, recombination, and migration rates in recapitation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#timeunitsmismatchwarning"><code class="docutils literal notranslate"><span class="pre">TimeUnitsMismatchWarning</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-calculating-generation-times-in-a-slim-simulation">Example: calculating generation times in a SLiM simulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#converting-from-slim-time-to-tskit-time-and-back">Converting from SLiM time to tskit time and back</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#detailed-description-of-conversion">Detailed description of conversion</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="time-units">
<h1>Time units<a class="headerlink" href="#time-units" title="Link to this heading">#</a></h1>
<p>There are a number of subtle ways that time units can trip up the user;
below are explanations of how to deal with most of these topics.
At issue is the fact that tree sequences produced by SLiM
have times in units of “ticks”, rather than generations.
If we query such a tree sequence for its time units we see
its return value</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span><span class="o">.</span><span class="n">time_units</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;ticks&#39;
</pre></div>
</div>
</div>
</div>
<p>In general this mean it can be conceptually tricky to make sure that time units
are consistent across different stages of simulation.</p>
<section id="that-warning-from-recapitate-about-time-units">
<h2>That warning from recapitate about time units<a class="headerlink" href="#that-warning-from-recapitate-about-time-units" title="Link to this heading">#</a></h2>
<p>If you recapitate a tree sequence then you’ve probably seen the warning</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TimeUnitsMismatchWarning</span><span class="p">:</span> <span class="n">The</span> <span class="n">initial_state</span> <span class="n">has</span> <span class="n">time_units</span><span class="o">=</span><span class="n">ticks</span> <span class="n">but</span> <span class="n">time</span> <span class="ow">is</span> <span class="n">measured</span>
<span class="ow">in</span> <span class="n">generations</span> <span class="ow">in</span> <span class="n">msprime</span><span class="o">.</span> <span class="n">This</span> <span class="n">may</span> <span class="n">lead</span> <span class="n">to</span> <span class="n">significant</span> <span class="n">discrepancies</span> <span class="n">between</span> <span class="n">the</span> <span class="n">timescales</span><span class="o">.</span> 
</pre></div>
</div>
<p>This is a handy reminder to think about the issue, because it is important.
However, if you’re running a single-species WF simulation,
then the time units <em>are</em> in generations (unless you’re doing something very creative).
If so, you can avoid this warning by setting the time units to “generations”,
using the <code class="docutils literal notranslate"><span class="pre">timeUnit</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">initializeTreeSeq(</span> <span class="pre">)</span></code>.
However, this <em>only</em> affects the <em>label</em> in metadata (i.e., the output of
<code class="docutils literal notranslate"><span class="pre">ts.time_units</span></code>, and does not actually change how times are recorded
in the tree sequence, so please only do this if you are running a WF simulation
(and, keep reading).</p>
</section>
<section id="mutation-rates-with-msprime">
<h2>Mutation rates with msprime<a class="headerlink" href="#mutation-rates-with-msprime" title="Link to this heading">#</a></h2>
<p>Only you really know how much time in the real world
corresponds to one spin around SLiM’s life cycle.
So, SLiM does not specify what its time units actually are,
and refers to them as “ticks”.
Previous versions of SLiM called these “generations”,
but this is only correct for simulations in which all organisms die every tick,
e.g., a single-species WF model.
Converting these times into real-world times is usually not too hard:
maybe in your simulation one tick = one year,
or maybe you need to multiply by a (mean) generation time known from empirical data.</p>
<p>However, it becomes important to know what the time units are
when interfacing with msprime.
For instance, suppose you’ve done a WF simulation for an organism whose mean generation time
in the real world is 30 years, and you want to overlay neutral mutations using msprime.
The mutation rate passed to msprime is in units of mutations per unit-of-time-in-the-tree-sequence,
so since you did a WF simulation, the units of time in the tree sequence are in generations,
and you should give it mutation rate in mutations per generation.
As long as your mutation rate is in units of mutations per bp per generation, as is typical,
no adjustment is needed, but if it were in different units, such as per year,
it would need to be changed.
(The rate in units of mutations per year would be 30 times smaller,
and so would give you 30 times fewer neutral mutations than you want.)</p>
</section>
<section id="coalescence-recombination-and-migration-rates-in-recapitation">
<h2>Coalescence, recombination, and migration rates in recapitation<a class="headerlink" href="#coalescence-recombination-and-migration-rates-in-recapitation" title="Link to this heading">#</a></h2>
<p><em>Note: this section is only relevant for nonWF SLiM simulations:
in a single-species WF simulation, one tick = one generation,
so no adjustment is needed.</em></p>
<p>If you recapitate with msprime, then the same issue occurs for coalescence rates.
This is less obvious, because “coalescence rate” is not an argument to msprime;
rather, the coalescence rate in a given population
is <span class="math notranslate nohighlight">\(1/2N\)</span>, where <span class="math notranslate nohighlight">\(N\)</span> is the (effective) size of that population.
(The 2 in the denominator is actually the ‘ploidy’ argument to msprime, which defaults to 2.)
This is the correct rate, <em>in units of coalescences per generation</em>.
Since it’s “per generation”, this means that if you want to recapitate a tree sequence
generated by SLiM in which one tick is not one generation,
then <strong>you need to adjust the effective population sizes accordingly</strong>.
For instance, suppose as above that we did a nonWF simulation
in which one tick = one year, for a species with generation time 30 years,
and we want to recapitate with an effective size of 10,000 diploids.
An effective size of 10,000 diploids means one coalescence per pair of lineages
every 20,000 generations;
since one unit of time in the tree sequence equals 1/30th of a generation,
this is one coalescence per pair of lineages every 600,000 time units,
which we can get msprime to do by asking for an effective population size of 300,000.
In other words, if a generation in our tree sequence is <span class="math notranslate nohighlight">\(T\)</span> units of time,
then we need to divide the coalescence rate by <span class="math notranslate nohighlight">\(T,\)</span>
which we do by multiplying effective population sizes by <span class="math notranslate nohighlight">\(T\)</span>.</p>
<p>(A better way of thinking about this could be to say that since the mean time to coalescence
is twice the effective population size,
actually effective population size is in units of <em>time</em>, rather than individuals.)</p>
<p>To recapitate we need to also pick recombination and (possibly) migration rates.
Since these are rates, they are also in units of something “per time”,
and so just as for mutation rates, we need to ensure they are in the correct units.
Recombination rates in particular come in units of “per generation”
(since a Morgan is in units of recombinations per generation),
and so a rate of <span class="math notranslate nohighlight">\(r\)</span> Morgans would need to be divided by <span class="math notranslate nohighlight">\(T\)</span>
before it’s passed to msprime for recapitation.
Since msprime (by default) runs a continuous-time simulation,
there is no harm in adjusting time units in msprime this way,
but it is confusing.</p>
<section id="timeunitsmismatchwarning">
<h3><code class="docutils literal notranslate"><span class="pre">TimeUnitsMismatchWarning</span></code><a class="headerlink" href="#timeunitsmismatchwarning" title="Link to this heading">#</a></h3>
<p>Above we saw that if we want msprime to simulate coalescence in a population of size 10,000
to recapitate our tree sequence whose times are given in units of 1/30th of a generation,
then we need to ask it for a population of (effective) size 300,000.
In other words, the “population sizes” of msprime are <em>only</em> in units of individuals
(as one would expect a population size to be)
<em>if</em> times are being measured in units of generations.
For this reason, although it’s not strictly true,
sometimes we say that “msprime times are in units of generations”.
Also, msprime will produce a warning if it is handed a tree sequence
whose time units are not “generations”:</p>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rts</span> <span class="o">=</span> <span class="n">pyslim</span><span class="o">.</span><span class="n">recapitate</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span>
            <span class="n">recombination_rate</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
            <span class="n">ancestral_Ne</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TimeUnitsMismatchWarning: The initial_state has time_units=ticks but time is measured in
generations in msprime. This may lead to significant discrepancies between the timescales.
If you wish to suppress this warning, you can use, e.g., warnings.simplefilter(&#39;ignore&#39;,
msprime.TimeUnitsMismatchWarning)
</pre></div>
</div>
</div>
</div>
<p>Think of this warning as a friendly reminder to pay attention to your time units.
To make this warning disappear, the easiest option is to do as the warning suggests
and just ask python to ignore it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">msprime</span><span class="o">.</span><span class="n">TimeUnitsMismatchWarning</span><span class="p">)</span>
<span class="n">rts</span> <span class="o">=</span> <span class="n">pyslim</span><span class="o">.</span><span class="n">recapitate</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span>
            <span class="n">recombination_rate</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
            <span class="n">ancestral_Ne</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To re-label the time units on your tree sequence
as being in “generations” (but! only do this if it’s true!),
you must convert to a TableCollection and back (since the tables are mutable
but the tree sequence is not):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time units before: </span><span class="si">{</span><span class="n">ts</span><span class="o">.</span><span class="n">time_units</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">dump_tables</span><span class="p">()</span>
<span class="n">t</span><span class="o">.</span><span class="n">time_units</span> <span class="o">=</span> <span class="s1">&#39;generations&#39;</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">tree_sequence</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time units after: </span><span class="si">{</span><span class="n">ts</span><span class="o">.</span><span class="n">time_units</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time units before: ticks
Time units after: generations
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="example-calculating-generation-times-in-a-slim-simulation">
<h2>Example: calculating generation times in a SLiM simulation<a class="headerlink" href="#example-calculating-generation-times-in-a-slim-simulation" title="Link to this heading">#</a></h2>
<p>In a nonWF simulation, the generation time is not something that you get to explicitly set:
rather, like population size it is an emergent property of the rules of the simulation.
So, it’s important to be able to calculate what the (average) generation time actually is
in a given simulation (keeping in mind that the answer may vary across time and space).
This is not really a pyslim operation at all,
but since it’s important to the considerations above,
here’s an easy way to do this.
The definition of generation time appropriate for comparison to a coalescent simulation
is “average amount of time between birth of parent and birth of child”.
(Note that this is the birth of the <em>average</em> child in some sense,
not the average time to each parent’s first child!)
Therefore,
an easy and convenient way to measure this is to
record for each individual their parents’ ages at the times of their births,
and then take the average across all individuals alive at a given time.
(This is only one possible choice,
and other choices are usually but not always equivalent,
but a discussion of the options and distinctions
would make this tutorial lengthy and confusing.</p>
<p>Here is a script that computes this.
In the simulation, females’ fecundity increases with their age,
and so we expect “generation time” to be larger than the mean age of individuals
alive at a given time.
In the script, we store the average of the mean parent ages across all
extant individuals every tick using SLiM Individuals’ <code class="docutils literal notranslate"><span class="pre">meanParentAge</span></code> property,
and store the vector in top-level metadata when we write out the tree sequence.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">initialize</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">initializeSLiMModelType</span><span class="p">(</span><span class="s2">&quot;nonWF&quot;</span><span class="p">);</span>
	<span class="n">initializeSex</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">);</span>
	<span class="n">initializeTreeSeq</span><span class="p">();</span>
	<span class="n">initializeMutationRate</span><span class="p">(</span><span class="mf">2e-8</span><span class="p">);</span>
	<span class="n">initializeMutationType</span><span class="p">(</span><span class="s2">&quot;m1&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span>
	<span class="n">initializeGenomicElementType</span><span class="p">(</span><span class="s2">&quot;g1&quot;</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
	<span class="n">initializeGenomicElement</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1e8</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
	<span class="n">initializeRecombinationRate</span><span class="p">(</span><span class="mf">1e-8</span><span class="p">);</span>
	<span class="n">defineConstant</span><span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
	<span class="n">defineGlobal</span><span class="p">(</span><span class="s2">&quot;GENTIME&quot;</span><span class="p">,</span> <span class="n">rep</span><span class="p">(</span><span class="n">NAN</span><span class="p">,</span> <span class="mi">100</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">reproduction</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">seqLen</span><span class="p">(</span><span class="n">rpois</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">individual</span><span class="o">.</span><span class="n">age</span><span class="p">)))</span> <span class="p">{</span>
		<span class="n">mate</span> <span class="o">=</span> <span class="n">subpop</span><span class="o">.</span><span class="n">sampleIndividuals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sex</span><span class="o">=</span><span class="s2">&quot;M&quot;</span><span class="p">);</span>
		<span class="n">offspring</span> <span class="o">=</span> <span class="n">subpop</span><span class="o">.</span><span class="n">addCrossed</span><span class="p">(</span><span class="n">individual</span><span class="p">,</span> <span class="n">mate</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="mi">1</span> <span class="n">early</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">sim</span><span class="o">.</span><span class="n">addSubpop</span><span class="p">(</span><span class="s2">&quot;p1&quot;</span><span class="p">,</span> <span class="n">K</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">early</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">p1</span><span class="o">.</span><span class="n">fitnessScaling</span> <span class="o">=</span> <span class="n">K</span> <span class="o">/</span> <span class="n">p1</span><span class="o">.</span><span class="n">individualCount</span><span class="p">;</span>
<span class="p">}</span>

<span class="mi">1</span><span class="p">:</span> <span class="n">late</span><span class="p">()</span> <span class="p">{</span>
	<span class="o">//</span> <span class="n">this</span> <span class="n">should</span> <span class="n">happen</span> <span class="o">*</span><span class="n">after</span><span class="o">*</span> <span class="n">mortality</span> <span class="p">(</span><span class="n">so</span><span class="p">,</span> <span class="ow">in</span> <span class="n">late</span><span class="p">())</span>
	<span class="n">GENTIME</span><span class="p">[</span><span class="n">community</span><span class="o">.</span><span class="n">tick</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">individuals</span><span class="o">.</span><span class="n">meanParentAge</span><span class="p">);</span>
<span class="p">}</span>

<span class="mi">100</span> <span class="n">late</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">sim</span><span class="o">.</span><span class="n">treeSeqOutput</span><span class="p">(</span>
		<span class="s2">&quot;generation_time.trees&quot;</span><span class="p">,</span>
		<span class="n">metadata</span><span class="o">=</span><span class="n">Dictionary</span><span class="p">(</span><span class="s2">&quot;generation_times&quot;</span><span class="p">,</span> <span class="n">GENTIME</span><span class="p">)</span>
		<span class="p">);</span>
	<span class="n">catn</span><span class="p">(</span><span class="s2">&quot;Done! Mean generation time &quot;</span> <span class="o">+</span> <span class="n">mean</span><span class="p">(</span><span class="n">GENTIME</span><span class="p">[</span><span class="mi">50</span><span class="p">:</span><span class="mi">99</span><span class="p">]));</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">bash</span>
slim -s 23 generation_time.slim | tail -n1
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>#WARNING (Species::RunInitializeCallbacks): with tree-sequence recording enabled and a non-zero muta
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>tion rate, a neutral mutation type was defined and used; this is legal, but usually undesirable, sin
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ce neutral mutations can be overlaid later using the tree-sequence information.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Done! Mean generation time 2.55932
</pre></div>
</div>
</div>
</div>
<p>(About the warning: we turned on mutations for a good reason; see below.)
Now we can look at our empirical calculation of generation time.
Note that the first generation individuals have a mean parent age of 0.0,
so we expect generation time to go up at first.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gts</span> <span class="o">=</span> <span class="n">tskit</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;generation_time.trees&quot;</span><span class="p">)</span>
<span class="n">gentimes</span> <span class="o">=</span> <span class="n">gts</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;SLiM&quot;</span><span class="p">][</span><span class="s2">&quot;user_metadata&quot;</span><span class="p">][</span><span class="s2">&quot;generation_times&quot;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;tick&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;generation time&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gentimes</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">gentimes</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6bd6141ea0ead9cc05eee57896ef34e4d3b438c43530d48b1179fa6f43bc4638.png" src="_images/6bd6141ea0ead9cc05eee57896ef34e4d3b438c43530d48b1179fa6f43bc4638.png" />
</div>
</div>
<p>In the script above we added mutations during the SLiM simulation to do a simple check
to verify the <code class="docutils literal notranslate"><span class="pre">meanParentAge</span></code> property correctly estimates mean generation time.
If it does, then the mean sequence divergence calculated from the mutations introduced by SLiM
should (approximately) match the mean length of branches in the tree sequence separating two samples
multiplied by the expected number of mutations per unit time.
(We get the mean branch length using the <a class="reference external" href="https://tskit.dev/tskit/docs/stable/python-api.html#tskit.TreeSequence.diversity" title="(in Project name not set)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ts.diversity</span></code></a> method with <code class="docutils literal notranslate"><span class="pre">mode=&quot;branch&quot;</span></code>;
see the <a class="reference external" href="https://tskit.dev/tskit/docs/stable/stats.html#sec-stats" title="(in Project name not set)"><span class="xref std std-ref">tskit documentation</span></a> for details.)
This involves the generation time because “mutations per unit time” is equal to
“mutations per generation” (here, the mutation rate per bp, <span class="math notranslate nohighlight">\(2 \times 10^{-8}\)</span>)
divided by “time per generation” (i.e., mean generation time).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">slim_diversity</span> <span class="o">=</span> <span class="n">gts</span><span class="o">.</span><span class="n">diversity</span><span class="p">(</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;site&#39;</span><span class="p">)</span>
<span class="n">ts_diversity</span> <span class="o">=</span> <span class="n">gts</span><span class="o">.</span><span class="n">diversity</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;branch&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mf">2e-8</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">gentimes</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;slim diversity: </span><span class="si">{</span><span class="n">slim_diversity</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
      <span class="sa">f</span><span class="s2">&quot;scaled tree sequence diversity: </span><span class="si">{</span><span class="n">ts_diversity</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
      <span class="sa">f</span><span class="s2">&quot;error: </span><span class="si">{</span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">slim_diversity</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ts_diversity</span><span class="p">)</span><span class="o">/</span><span class="n">slim_diversity</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">%&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>slim diversity: 1.501203409187523e-06
scaled tree sequence diversity: 1.5783075851285295e-06
error: 5.136%
</pre></div>
</div>
</div>
</div>
<p>Now, to recapitate this simulation
in a population with effective size 1000,
and using the recombination rate from the SLiM script of <span class="math notranslate nohighlight">\(10^{-8}\)</span>
crossovers per generation
and <span class="math notranslate nohighlight">\(2 \times 10^{-8}\)</span> mutations per generation,
we need to scale <span class="math notranslate nohighlight">\(N_e\)</span> and both rates by the generation time.
Furthermore, since we already have mutations up until 100 time units ago,
we need to put mutations on only previous to that time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gentimes</span> <span class="o">=</span> <span class="n">gts</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;SLiM&quot;</span><span class="p">][</span><span class="s2">&quot;user_metadata&quot;</span><span class="p">][</span><span class="s2">&quot;generation_times&quot;</span><span class="p">]</span>
<span class="n">gt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">gentimes</span><span class="p">[</span><span class="o">-</span><span class="mi">50</span><span class="p">:])</span>
<span class="n">recomb_rate</span> <span class="o">=</span> <span class="mf">1e-8</span> <span class="c1"># per generation</span>
<span class="n">Ne</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1"># generations</span>
<span class="n">mut_rate</span> <span class="o">=</span> <span class="mf">2e-8</span> <span class="c1"># per generation</span>
<span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">(</span><span class="n">record</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">w</span><span class="p">:</span>
    <span class="n">rts</span> <span class="o">=</span> <span class="n">pyslim</span><span class="o">.</span><span class="n">recapitate</span><span class="p">(</span><span class="n">gts</span><span class="p">,</span>
                <span class="n">recombination_rate</span><span class="o">=</span><span class="n">recomb_rate</span> <span class="o">/</span> <span class="n">gt</span><span class="p">,</span>
                <span class="n">ancestral_Ne</span><span class="o">=</span><span class="n">Ne</span> <span class="o">*</span> <span class="n">gt</span><span class="p">,</span>
                <span class="n">random_seed</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">mts</span> <span class="o">=</span> <span class="n">msprime</span><span class="o">.</span><span class="n">sim_mutations</span><span class="p">(</span>
               <span class="n">rts</span><span class="p">,</span>
               <span class="n">rate</span><span class="o">=</span><span class="n">mut_rate</span> <span class="o">/</span> <span class="n">gt</span><span class="p">,</span>
               <span class="n">model</span><span class="o">=</span><span class="n">msprime</span><span class="o">.</span><span class="n">SLiMMutationModel</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
               <span class="n">keep</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
               <span class="n">start_time</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean genetic diversity is now </span><span class="si">{</span><span class="n">mts</span><span class="o">.</span><span class="n">diversity</span><span class="p">()</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
      <span class="sa">f</span><span class="s2">&quot;  and the expected value under a WF model is &quot;</span>
      <span class="sa">f</span><span class="s2">&quot;4 * N * mu = </span><span class="si">{</span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Ne</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">mut_rate</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean genetic diversity is now 7.86e-05,
  and the expected value under a WF model is 4 * N * mu = 8.00e-05
</pre></div>
</div>
</div>
</div>
<p>We get a lower value of genetic diversity than expected under a WF model,
but that’s expected because both fluctuating population sizes
and age-associated variability in fecundity will decrease the effective population size.</p>
</section>
<section id="converting-from-slim-time-to-tskit-time-and-back">
<span id="sec-metadata-converting-times"></span><h2>Converting from SLiM time to tskit time and back<a class="headerlink" href="#converting-from-slim-time-to-tskit-time-and-back" title="Link to this heading">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is a nitpicky, document-the-details section.
Hopefully, you don’t have to deal with the specifics of converting between tskit and SLiM time,
but this page is here for you if you do.</p>
</div>
<p>SLiM is a forwards simulator, while the tree sequence format thinks about things
<em>retrospectively</em>, and so works with times in units of <em>time ago</em>.
Mostly, you don’t have to convert between the two,
unless you want to match up information in a tree sequence
with information written out by SLiM itself.
In other words, SLiM’s time counter measures the number of time steps
(“ticks”) since the start of the simulation,
and times in the tree sequence record how long before the end of the simulation.
However, there are quite a few details, and off-by-one errors are easy to make,
so we’ll spell it out here.
Hopefully, you can just use pyslim’s methods
<a class="reference internal" href="python_api.html#pyslim.slim_time" title="pyslim.slim_time"><code class="xref py py-func docutils literal notranslate"><span class="pre">slim_time()</span></code></a>, <a class="reference internal" href="python_api.html#pyslim.individuals_alive_at" title="pyslim.individuals_alive_at"><code class="xref py py-func docutils literal notranslate"><span class="pre">individuals_alive_at()</span></code></a>,
and <a class="reference internal" href="python_api.html#pyslim.individual_ages_at" title="pyslim.individual_ages_at"><code class="xref py py-func docutils literal notranslate"><span class="pre">individual_ages_at()</span></code></a>
without needing to actually do any conversions yourself.</p>
<p>SLiM’s time counter is called the “tick”.
The SLiM tick starts at 1, and records which round of the life cycle the simulation is in.
However, the order of the life cycle differs between WF and nonWF models:
in a WF model, it is <em>first</em> <span class="math notranslate nohighlight">\(\to\)</span> <em>early</em> <span class="math notranslate nohighlight">\(\to\)</span> <em>birth</em> <span class="math notranslate nohighlight">\(\to\)</span> <em>late</em>”,
while in a nonWF model, it is <em>first</em> <span class="math notranslate nohighlight">\(\to\)</span> <em>birth</em> <span class="math notranslate nohighlight">\(\to\)</span> <em>early</em> <span class="math notranslate nohighlight">\(\to\)</span> <em>late</em>.
Often, the first set of individuals are created in the <em>early()</em> phase of tick 1,
and so in a WF model reproduce immediately, in the same tick they were “born”.
Parents and offspring cannot have the same birth time in the tree sequence,
and so some clever bookkeeping was required.
You’ll want to refer to the tables below to see what’s going on.
“Time” in a tree sequence is actually <em>time ago</em>,
or <em>time before the tree sequence was recorded</em>.
To obtain this number, and ensure that offspring cannot have the same birth time-ago
in the tree sequence as their parents,
SLiM also keeps track of “how many birth phases of the life cycle have happened so far”
(the column “# births” in the tables).
As the simulation goes along,
tskit time ago is recorded as minus one times the number of birth phases so far.
(We multiply by -1 because as we move forward in time,
we accumulate a negative number of “time-ago” units.)
When the tree sequence is output, the current cumulative number of birth phases
is added to this,
so “tskit time ago” is, equivalently, “how many birth phases happened since this time”.
In a nonWF model, the two counters (“tick” and “number of birth phases”)
are always in sync; but in a WF model they are not (during <em>first</em> and <em>early</em>).
The extra wrinkle this introduces is that the correspondence between “tskit time ago”
and “SLiM time” depends on <em>which phase the tree sequence was recorded in</em>.</p>
<p>When the tree sequence is written out, SLiM records the value of its current tick,
cycle, and stage,
which can be found in the metadata: <code class="docutils literal notranslate"><span class="pre">ts.metadata['SLiM']['tick']</span></code>,
<code class="docutils literal notranslate"><span class="pre">ts.metadata['SLiM']['cycle']</span></code>, and <code class="docutils literal notranslate"><span class="pre">ts.metadata['SLiM']['stage']</span></code>.
The “SLiM time” referred to by a <code class="docutils literal notranslate"><span class="pre">time</span></code> in the tree sequence
(i.e., the value that would be reported by <code class="docutils literal notranslate"><span class="pre">community.tick</span></code>
within SLiM at the point in time thus referenced)
can be obtained by subtracting <code class="docutils literal notranslate"><span class="pre">time</span></code> from <code class="docutils literal notranslate"><span class="pre">ts.metadata['SLiM']['tick']</span></code>
and possibly adding or subtracting one depending on the current stage.
The fiddly details are worked out by the <a class="reference internal" href="python_api.html#pyslim.slim_time" title="pyslim.slim_time"><code class="xref py py-func docutils literal notranslate"><span class="pre">slim_time()</span></code></a> method,
which takes a <code class="docutils literal notranslate"><span class="pre">stage</span></code> argument.</p>
<p>Some of the other methods in pyslim – those that depend on <a class="reference internal" href="python_api.html#pyslim.individuals_alive_at" title="pyslim.individuals_alive_at"><code class="xref py py-func docutils literal notranslate"><span class="pre">individuals_alive_at()</span></code></a>
– need you to tell them during which stage the tree sequence was saved with <code class="docutils literal notranslate"><span class="pre">sim.treeSeqOutput</span></code>,
and need this to be the same as the stage that any individuals were saved with <code class="docutils literal notranslate"><span class="pre">sim.treeSeqRememberIndividuals</span></code>.
(This can add another factor of plus or minus one to the calculations.)
This argument, <code class="docutils literal notranslate"><span class="pre">remembered_stage</span></code>, defaults to <em>late()</em>;
we recommend that you also default to always Remembering individuals, and saving out the tree sequence,
during <em>late()</em> as well, unless you have good reason not to.</p>
<section id="detailed-description-of-conversion">
<h3>Detailed description of conversion<a class="headerlink" href="#detailed-description-of-conversion" title="Link to this heading">#</a></h3>
<p>To help keep all this straight, here are schematics for WF and nonWF models.
(To see the nonWF model schematic, click on the “nonWF” tab.)</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
<label class="sd-tab-label" for="sd-tab-item-0">
WF model</label><div class="sd-tab-content docutils">
<p>For a WF model, the SLiM tick (first column) can be obtained by subtracting the
tskit time ago from the SLiM tick at time of output only during the same stage that output occured in.
Suppose that we want to know what tick counter in SLiM corresponds to a given tskit time ago.
The answer to this depends on what stage, unfortunately.
Let <span class="math notranslate nohighlight">\(k\)</span> be the value of the tick counter, <span class="math notranslate nohighlight">\(n\)</span> be the total number of ticks,
i.e., the value of <code class="docutils literal notranslate"><span class="pre">ts.metadata[&quot;SLiM&quot;][&quot;tick&quot;]</span></code>,
<span class="math notranslate nohighlight">\(t\)</span> be the tskit time,
<span class="math notranslate nohighlight">\(x=1\)</span> if the stage is <em>first()</em> or <em>early()</em> and 0 otherwise,
and <span class="math notranslate nohighlight">\(y=1\)</span> if the tree sequence was output in <em>late()</em>.
Then, as can be verified from the table below, <span class="math notranslate nohighlight">\(k + t = n + x + y - 1\)</span>.
The right-hand columns show <span class="math notranslate nohighlight">\(t\)</span>, i.e.,
what the <strong>tskit time ago</strong> is at the corresponding point in the SLiM simulation.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>tick</p></th>
<th class="head"><p>stage</p></th>
<th class="head"><p># births</p></th>
<th class="head"><p></p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">first</span></code> output</p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">early</span></code> output</p></th>
<th class="head"><p><code class="docutils literal notranslate"><span class="pre">late</span></code> output</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>first</p></td>
<td><p>0</p></td>
<td><p><span class="math notranslate nohighlight">\(\leftarrow\)</span> add subpops</p></td>
<td><p>n-1</p></td>
<td><p>n-1</p></td>
<td><p>n</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>early</p></td>
<td><p>0</p></td>
<td><p></p></td>
<td><p>n-1</p></td>
<td><p>n-1</p></td>
<td><p>n</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>birth</p></td>
<td><p>1</p></td>
<td><p></p></td>
<td><p>n-2</p></td>
<td><p>n-2</p></td>
<td><p>n-1</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>late</p></td>
<td><p>1</p></td>
<td><p></p></td>
<td><p>n-2</p></td>
<td><p>n-2</p></td>
<td><p>n-1</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>first</p></td>
<td><p>1</p></td>
<td><p></p></td>
<td><p>n-2</p></td>
<td><p>n-2</p></td>
<td><p>n-1</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>early</p></td>
<td><p>1</p></td>
<td><p></p></td>
<td><p>n-2</p></td>
<td><p>n-2</p></td>
<td><p>n-1</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>birth</p></td>
<td><p>2</p></td>
<td><p></p></td>
<td><p>n-3</p></td>
<td><p>n-3</p></td>
<td><p>n-2</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>late</p></td>
<td><p>2</p></td>
<td><p></p></td>
<td><p>n-3</p></td>
<td><p>n-3</p></td>
<td><p>n-2</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>first</p></td>
<td><p>2</p></td>
<td><p></p></td>
<td><p>n-3</p></td>
<td><p>n-3</p></td>
<td><p>n-2</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>early</p></td>
<td><p>2</p></td>
<td><p></p></td>
<td><p>n-3</p></td>
<td><p>n-3</p></td>
<td><p>n-2</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>birth</p></td>
<td><p>3</p></td>
<td><p></p></td>
<td><p>n-4</p></td>
<td><p>n-4</p></td>
<td><p>n-3</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>late</p></td>
<td><p>3</p></td>
<td><p></p></td>
<td><p>n-4</p></td>
<td><p>n-4</p></td>
<td><p>n-3</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\downarrow\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\cdots\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\downarrow\)</span></p></td>
<td><p></p></td>
<td><p><span class="math notranslate nohighlight">\(\uparrow\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\uparrow\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\uparrow\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>n-2</p></td>
<td><p>first</p></td>
<td><p>n-3</p></td>
<td><p></p></td>
<td><p>2</p></td>
<td><p>2</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>n-2</p></td>
<td><p>early</p></td>
<td><p>n-3</p></td>
<td><p></p></td>
<td><p>2</p></td>
<td><p>2</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>n-2</p></td>
<td><p>birth</p></td>
<td><p>n-2</p></td>
<td><p></p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>n-2</p></td>
<td><p>late</p></td>
<td><p>n-2</p></td>
<td><p></p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>n-1</p></td>
<td><p>first</p></td>
<td><p>n-2</p></td>
<td><p></p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>n-1</p></td>
<td><p>early</p></td>
<td><p>n-2</p></td>
<td><p></p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>n-1</p></td>
<td><p>birth</p></td>
<td><p>n-1</p></td>
<td><p></p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>n-1</p></td>
<td><p>late</p></td>
<td><p>n-1</p></td>
<td><p></p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>n</p></td>
<td><p>first</p></td>
<td><p>n-1</p></td>
<td><p>treeSeqOutput <span class="math notranslate nohighlight">\(\to\)</span></p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>n</p></td>
<td><p>early</p></td>
<td><p>n-1</p></td>
<td><p></p></td>
<td><p>treeSeqOutput <span class="math notranslate nohighlight">\(\to\)</span></p></td>
<td><p>0</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>n</p></td>
<td><p>birth</p></td>
<td><p>n</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p>n</p></td>
<td><p>late</p></td>
<td><p>n</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p>treeSeqOutput <span class="math notranslate nohighlight">\(\to\)</span></p></td>
<td><p>0</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<input id="sd-tab-item-1" name="sd-tab-set-0" type="radio">
<label class="sd-tab-label" for="sd-tab-item-1">
nonWF model</label><div class="sd-tab-content docutils">
<p>Note that for nonWF models the SLiM time (first column) can always be obtained by subtracting the
tskit time ago from the SLiM time at time of output.
Suppose that we want to know what tick counter in SLiM corresponds to a given tskit time ago.
The answer to this depends on what stage, unfortunately.
Let <span class="math notranslate nohighlight">\(k\)</span> be the value of the tick counter, <span class="math notranslate nohighlight">\(n\)</span> be the total number of ticks,
i.e., the value of <code class="docutils literal notranslate"><span class="pre">ts.metadata[&quot;SLiM&quot;][&quot;tick&quot;]</span></code>,
let <span class="math notranslate nohighlight">\(t\)</span> be the tskit time,
<span class="math notranslate nohighlight">\(x=1\)</span> if the stage is “first” and 0 otherwise,
and <span class="math notranslate nohighlight">\(y=1\)</span> if the tree sequence was output in <em>early()</em> or <em>late()</em>.
Then, as can be verified from the table below, <span class="math notranslate nohighlight">\(k + t = n + x + y - 1\)</span>.
The right-hand columns show <span class="math notranslate nohighlight">\(t\)</span>, i.e.,
what the <strong>tskit time ago</strong> is at the corresponding point in the SLiM simulation.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>tick</p></th>
<th class="head"><p>stage</p></th>
<th class="head"><p># births</p></th>
<th class="head"><p></p></th>
<th class="head"><p>first output</p></th>
<th class="head"><p>early output</p></th>
<th class="head"><p>late output</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>first</p></td>
<td><p>0</p></td>
<td><p><span class="math notranslate nohighlight">\(\leftarrow\)</span> add subpops</p></td>
<td><p>n-1</p></td>
<td><p>n</p></td>
<td><p>n</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>birth</p></td>
<td><p>1</p></td>
<td><p></p></td>
<td><p>n-2</p></td>
<td><p>n-1</p></td>
<td><p>n-1</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>early</p></td>
<td><p>1</p></td>
<td><p><span class="math notranslate nohighlight">\(\leftarrow\)</span> add subpops</p></td>
<td><p>n-2</p></td>
<td><p>n-1</p></td>
<td><p>n-1</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>late</p></td>
<td><p>1</p></td>
<td><p></p></td>
<td><p>n-2</p></td>
<td><p>n-1</p></td>
<td><p>n-1</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>first</p></td>
<td><p>1</p></td>
<td><p></p></td>
<td><p>n-2</p></td>
<td><p>n-1</p></td>
<td><p>n-1</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>birth</p></td>
<td><p>2</p></td>
<td><p></p></td>
<td><p>n-3</p></td>
<td><p>n-2</p></td>
<td><p>n-2</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>early</p></td>
<td><p>2</p></td>
<td><p></p></td>
<td><p>n-3</p></td>
<td><p>n-2</p></td>
<td><p>n-2</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>late</p></td>
<td><p>2</p></td>
<td><p></p></td>
<td><p>n-3</p></td>
<td><p>n-2</p></td>
<td><p>n-2</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>first</p></td>
<td><p>2</p></td>
<td><p></p></td>
<td><p>n-3</p></td>
<td><p>n-2</p></td>
<td><p>n-2</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>birth</p></td>
<td><p>3</p></td>
<td><p></p></td>
<td><p>n-4</p></td>
<td><p>n-3</p></td>
<td><p>n-3</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>early</p></td>
<td><p>3</p></td>
<td><p></p></td>
<td><p>n-4</p></td>
<td><p>n-3</p></td>
<td><p>n-3</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>late</p></td>
<td><p>3</p></td>
<td><p></p></td>
<td><p>n-4</p></td>
<td><p>n-3</p></td>
<td><p>n-3</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\downarrow\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\cdots\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\downarrow\)</span></p></td>
<td><p></p></td>
<td><p><span class="math notranslate nohighlight">\(\uparrow\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\uparrow\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\uparrow\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>n-2</p></td>
<td><p>first</p></td>
<td><p>n-3</p></td>
<td><p></p></td>
<td><p>2</p></td>
<td><p>3</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>n-2</p></td>
<td><p>birth</p></td>
<td><p>n-2</p></td>
<td><p></p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>n-2</p></td>
<td><p>early</p></td>
<td><p>n-2</p></td>
<td><p></p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>n-2</p></td>
<td><p>late</p></td>
<td><p>n-2</p></td>
<td><p></p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>n-1</p></td>
<td><p>first</p></td>
<td><p>n-2</p></td>
<td><p></p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>n-1</p></td>
<td><p>birth</p></td>
<td><p>n-1</p></td>
<td><p></p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>n-1</p></td>
<td><p>early</p></td>
<td><p>n-1</p></td>
<td><p></p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>n-1</p></td>
<td><p>late</p></td>
<td><p>n-1</p></td>
<td><p></p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>n</p></td>
<td><p>first</p></td>
<td><p>n-1</p></td>
<td><p>treeSeqOutput <span class="math notranslate nohighlight">\(\to\)</span></p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>n</p></td>
<td><p>birth</p></td>
<td><p>n</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>n</p></td>
<td><p>early</p></td>
<td><p>n</p></td>
<td><p></p></td>
<td><p>treeSeqOutput <span class="math notranslate nohighlight">\(\to\)</span></p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p>n</p></td>
<td><p>late</p></td>
<td><p>n</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p>treeSeqOutput <span class="math notranslate nohighlight">\(\to\)</span></p></td>
<td><p>0</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="vignette_parallel_phylo.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Vignette: Parallelizing SLiM simulations in a phylogenetic tree</p>
      </div>
    </a>
    <a class="right-next"
       href="metadata.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Metadata</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#that-warning-from-recapitate-about-time-units">That warning from recapitate about time units</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mutation-rates-with-msprime">Mutation rates with msprime</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#coalescence-recombination-and-migration-rates-in-recapitation">Coalescence, recombination, and migration rates in recapitation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#timeunitsmismatchwarning"><code class="docutils literal notranslate"><span class="pre">TimeUnitsMismatchWarning</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-calculating-generation-times-in-a-slim-simulation">Example: calculating generation times in a SLiM simulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#converting-from-slim-time-to-tskit-time-and-back">Converting from SLiM time to tskit time and back</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#detailed-description-of-conversion">Detailed description of conversion</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Tskit Developers
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2021.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>