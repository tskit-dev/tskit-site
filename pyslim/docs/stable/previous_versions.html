
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Migrating from previous versions of pyslim &#8212; PySLiM manual</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'previous_versions';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Python API" href="python_api.html" />
    <link rel="prev" title="Metadata" href="metadata.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <script data-goatcounter="https://tskit.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="introduction.html">
  
  
  
  
  
  
    <p class="title logo__title">PySLiM manual</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>

<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Using pyslim</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="vignette_space.html">Vignette: A spatial simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="vignette_continuing.html">Vignette: Following up with more coalescent simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="vignette_coalescent_diversity.html">Vignette: Starting with diversity generated by coalescent simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="vignette_parallel_phylo.html">Vignette: Parallelizing SLiM simulations in a phylogenetic tree</a></li>
<li class="toctree-l1"><a class="reference internal" href="time_units.html">Time units</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">Metadata</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Migrating from previous versions of pyslim</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">pyslim reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="python_api.html">Python API</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="development.html">Development</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/previous_versions.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Migrating from previous versions of pyslim</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">1.1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">1.0</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">0.700</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#legacy-metadata">Legacy metadata</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="migrating-from-previous-versions-of-pyslim">
<span id="sec-previous-versions"></span><h1>Migrating from previous versions of pyslim<a class="headerlink" href="#migrating-from-previous-versions-of-pyslim" title="Link to this heading">#</a></h1>
<section id="id1">
<h2>1.1<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<p>Release 1.1 goes along with SLiM v5, which introduces multichromosome support.
See <a class="reference internal" href="overview.html#sec-overview-vacant-nodes"><span class="std std-ref">Vacant nodes: sex chromosomes and haploidy</span></a> for a description of the possibility of “vacant” nodes.</p>
<ol class="arabic simple">
<li><p>Most importantly, if your tree sequence contains vacant nodes, these must
be removed or (better) simply amended to be not marked as samples before certain
operations, including computing statistics or recapitation.
To do this, you might do</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">removed_vacant</span> <span class="o">=</span> <span class="n">pyslim</span><span class="o">.</span><span class="n">has_vacant_samples</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
<span class="k">if</span> <span class="n">removed_vacant</span><span class="p">:</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">pyslim</span><span class="o">.</span><span class="n">remove_vacant</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Note that this does not remove the vacant nodes from the tree sequence, it just
removes them from the <em>sample</em>, which will make them invisible to most operations.
However, if you use <a class="reference internal" href="python_api.html#pyslim.recapitate" title="pyslim.recapitate"><code class="xref py py-func docutils literal notranslate"><span class="pre">recapitate()</span></code></a> then this is unnecessary, because
<strong><a class="reference internal" href="python_api.html#pyslim.recapitate" title="pyslim.recapitate"><code class="xref py py-func docutils literal notranslate"><span class="pre">recapitate()</span></code></a> does this for you.</strong></p>
<ol class="arabic simple" start="2">
<li><p>If you <em>have</em> removed vacant samples and you wish to reload the tree seqeuence
into SLiM, you’ll have to reverse this, like</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">removed_vacant</span><span class="p">:</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">pyslim</span><span class="o">.</span><span class="n">restore_vacant</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">remove_vacant</span></code> and <code class="docutils literal notranslate"><span class="pre">restore_vacant</span></code> are harmless on tree sequences
without vacant nodes; they’re just wrapped in <code class="docutils literal notranslate"><span class="pre">if</span></code> statements to avoid the extra
overhead if not needed.</p>
<ol class="arabic simple" start="3">
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">node.metadata[&quot;is_null&quot;]</span></code> with <code class="docutils literal notranslate"><span class="pre">node.metadata[&quot;is_vacant&quot;][0]</span> <span class="pre">&gt;</span> <span class="pre">0</span></code>.
(Previously, <code class="docutils literal notranslate"><span class="pre">is_null</span></code> contained a boolean; now it contains a list of ints;
for a single-chromosome simulation this will be a single int that will be
either 0 (if vacant) or 1 (if not).</p></li>
<li><p>Instead of checking <code class="docutils literal notranslate"><span class="pre">node.metadata[&quot;genome_type&quot;]</span></code>, instead consult
<code class="docutils literal notranslate"><span class="pre">ts.metadata[&quot;SLiM&quot;][&quot;this_chromosome&quot;][&quot;type&quot;]</span></code>. (It was previously redundant
to have a separate “genome type” entry for every node, anyhow.)</p></li>
</ol>
</section>
<section id="id2">
<h2>1.0<a class="headerlink" href="#id2" title="Link to this heading">#</a></h2>
<p>The pyslim 1.0 release coincides with that of SLiM v4,
which introduced a number of changes to SLiM.
pyslim remains backwards compatible, in that pyslim 1.0
will happily read tree sequences produced by previous versions of SLiM or pyslim,
and will convert them to the current version.
However, previous pyslim code may not work, due to two sets of changes:
(1) much of the functionality originally in pyslim has moved to tskit
(e.g., metadata processing), and (2) minor changes to terminology in SLiM v4
(“generation” is now “tick”).</p>
<p>Converting previous code should be straightforward, as there are exact replacements.
The most important changes are to remove calls to <code class="docutils literal notranslate"><span class="pre">pyslim.load(</span> <span class="pre">)</span></code> or <code class="docutils literal notranslate"><span class="pre">SlimTreeSequence(</span> <span class="pre">)</span></code>,
and change “generation=” arguments to “tick=”.</p>
<p>In more detail, to upgrade code you should:</p>
<ol class="arabic simple">
<li><p>Change <code class="docutils literal notranslate"><span class="pre">pyslim.load(</span> <span class="pre">)</span></code> to <code class="docutils literal notranslate"><span class="pre">tskit.load(</span> <span class="pre">)</span></code>.</p></li>
<li><p>Remove calls to <code class="docutils literal notranslate"><span class="pre">SlimTreeSequence(</span> <span class="pre">)</span></code>. They are not needed.</p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">generation</span></code> to <code class="docutils literal notranslate"><span class="pre">tick</span></code> in any arguments to functions, or in metadata.</p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">pyslim.annotate_defaults(</span> <span class="pre">)</span></code> to <code class="docutils literal notranslate"><span class="pre">pyslim.annotate(</span> <span class="pre">)</span></code>.
and <code class="docutils literal notranslate"><span class="pre">pyslim.annotate_defaults_tables(</span> <span class="pre">)</span></code> to <code class="docutils literal notranslate"><span class="pre">pyslim.annotate_tables(</span> <span class="pre">)</span></code>.</p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">pyslim.update_tables(</span> <span class="pre">)</span></code> to <code class="docutils literal notranslate"><span class="pre">pyslim.update(</span> <span class="pre">)</span></code>.</p></li>
</ol>
<p>Some methods of SlimTreeSequence are now methods of pyslim that take a tree sequence
as their first argument:</p>
<ol class="arabic simple" start="6">
<li><p>Change <code class="docutils literal notranslate"><span class="pre">ts.recapitate(...)</span></code> to <code class="docutils literal notranslate"><span class="pre">pyslim.recapitate(ts,</span> <span class="pre">...)</span></code>.</p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">ts.individuals_alive_at(t)</span></code> to <code class="docutils literal notranslate"><span class="pre">pyslim.individuals_alive_at(ts,</span> <span class="pre">t)</span></code>.</p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">ts.has_individual_parents()</span></code> to <code class="docutils literal notranslate"><span class="pre">pyslim.has_individual_parents(ts)</span></code>,
and <code class="docutils literal notranslate"><span class="pre">ts.individual_parents()</span></code> to <code class="docutils literal notranslate"><span class="pre">pyslim.individual_parents(ts)</span></code>.</p></li>
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">ts.first_generation_individuals()</span></code> with
an appropriate call to <code class="docutils literal notranslate"><span class="pre">pyslim.individuals_alive_at(</span> <span class="pre">)</span></code>.</p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">ts.mutation_at(...)</span></code> to <code class="docutils literal notranslate"><span class="pre">pyslim.mutation_at(ts,</span> <span class="pre">...)</span></code>.
and <code class="docutils literal notranslate"><span class="pre">ts.nucleotide_at(...)</span></code> to <code class="docutils literal notranslate"><span class="pre">pyslim.nucleotide_at(ts,</span> <span class="pre">...)</span></code>.</p></li>
</ol>
<p>Several properties previously provided by SlimTreeSequence are now provided
by TreeSequence (e.g., <code class="docutils literal notranslate"><span class="pre">ts.individual_times</span></code>); so these need no change.
However, these were briefly available as pyslim methods, so would need changing:</p>
<ol class="arabic simple" start="11">
<li><p>Change <code class="docutils literal notranslate"><span class="pre">pyslim.individual_times(ts)</span></code> to <code class="docutils literal notranslate"><span class="pre">ts.individuals_time</span></code>,
<code class="docutils literal notranslate"><span class="pre">pyslim.individual_populations(ts)</span></code> to <code class="docutils literal notranslate"><span class="pre">ts.individuals_population</span></code>, and
<code class="docutils literal notranslate"><span class="pre">pyslim.individual_locations(ts)</span></code> to <code class="docutils literal notranslate"><span class="pre">ts.individuals_location</span></code></p></li>
</ol>
<p>The change from <code class="docutils literal notranslate"><span class="pre">pyslim.annotate_defaults(</span> <span class="pre">)</span></code> to <code class="docutils literal notranslate"><span class="pre">pyslim.annotate(</span> <span class="pre">)</span></code>
also entailed some small changes in behavior. Most notably,
since msprime.sim_ancestry() now simulates individuals
by default, annotation does not set up individuals: if you have a tree
sequence without individuals (e.g., produced by msprime.simulate()) then you
need to set up those individuals yourself.</p>
<p>To update a tree sequence produced by an old version of SLiM to the current one,
use <code class="docutils literal notranslate"><span class="pre">pyslim.update(</span> <span class="pre">)</span></code>. (However, note that reading it in to SLiM and
writing it out again might be even easier.)</p>
<p>Also see notes below for 0.700.</p>
</section>
<section id="id3">
<h2>0.700<a class="headerlink" href="#id3" title="Link to this heading">#</a></h2>
<p>A number of features that were first introduced in pyslim have been made part of core
tskit functionality. For instance, reference sequence support was provided (although
loosely) inpyslim to support SLiM’s nucleotide models, but is now part of a standard
tskit <a class="reference external" href="https://tskit.dev/tskit/docs/stable/python-api.html#tskit.TreeSequence" title="(in Project name not set)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tskit.TreeSequence</span></code></a>. Similarly, metadata processing in tskit made
code to do this within pyslim obsolete; this “legacy metadata” code has been removed
and instructions for how to migrate your code are <a class="reference internal" href="#sec-legacy-metadata"><span class="std std-ref">below</span></a>.</p>
<p>In fact, we are now at the (very good) place where we don’t really need
the <code class="docutils literal notranslate"><span class="pre">pyslim.SlimTreeSequence</span></code> class any longer,
and it will soon be deprecated.
So, pyslim is migrating to be purely functional: instead of providing the SlimTreeSequence
class with specialized methods, all methods will be functions of TreeSequences,
that take in a tree sequence and return something
(a modified tree sequence or some summary of it).
Backwards compatibility will be maintained for some time, but we request that you
switch over sooner, as your code will be cleaner and faster.</p>
<p>To migrate, you should:</p>
<ol class="arabic simple">
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">ts.slim_generation</span></code> with <code class="docutils literal notranslate"><span class="pre">ts.metadata['SLiM']['generation']</span></code>,
and <code class="docutils literal notranslate"><span class="pre">ts.model_type</span></code> with <code class="docutils literal notranslate"><span class="pre">ts.metadata['SLiM']['model_type']</span></code>.</p></li>
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">ts.reference_sequence</span></code> with <code class="docutils literal notranslate"><span class="pre">ts.reference_sequence.data</span></code>.</p></li>
<li><p>Replace calls to <code class="docutils literal notranslate"><span class="pre">ts.recapitate(...)</span></code> with <code class="docutils literal notranslate"><span class="pre">pyslim.recapitate(ts,</span> <span class="pre">...)</span></code>,
and similarly with other SlimTreeSequence methods.</p></li>
</ol>
<p>If you encounter difficulties, please post an
<a class="reference external" href="https://github.com/tskit-dev/pyslim/issues">issue</a>
or <a class="reference external" href="https://github.com/tskit-dev/pyslim/discussions">discussion</a> on github.</p>
</section>
<section id="legacy-metadata">
<span id="sec-legacy-metadata"></span><h2>Legacy metadata<a class="headerlink" href="#legacy-metadata" title="Link to this heading">#</a></h2>
<p>In previous versions of pyslim,
SLiM-specific metadata was provided as customized objects:
for instance, for a node <code class="docutils literal notranslate"><span class="pre">n</span></code> provided by a <code class="docutils literal notranslate"><span class="pre">SlimTreeSequence</span></code>,
we’d have <code class="docutils literal notranslate"><span class="pre">n.metadata</span></code> as a <code class="docutils literal notranslate"><span class="pre">NodeMetadata</span></code> object,
with attributes <code class="docutils literal notranslate"><span class="pre">n.metadata.slim_id</span></code> and <code class="docutils literal notranslate"><span class="pre">n.metadata.is_null</span></code> and <code class="docutils literal notranslate"><span class="pre">n.metadata.genome_type</span></code>.
However, with tskit 0.3,
the capacity to deal with structured metadata
was implemented in <a class="reference external" href="https://tskit.dev/tskit/docs/stable/metadata.html#sec-metadata" title="(in Project name not set)"><span class="xref std std-ref">tskit itself</span></a>,
and so pyslim shifted to using the tskit-native metadata tools.
As a result, parsed metadata is provided as a dictionary instead of an object,
so that now <code class="docutils literal notranslate"><span class="pre">n.metadata</span></code> would be a dict,
with entries <code class="docutils literal notranslate"><span class="pre">n.metadata[&quot;slim_id&quot;]</span></code> and <code class="docutils literal notranslate"><span class="pre">n.metadata[&quot;is_vacant&quot;]</span></code>
(previously, <code class="docutils literal notranslate"><span class="pre">n.metadata[&quot;is_null&quot;]</span></code> and <code class="docutils literal notranslate"><span class="pre">n.metadata[&quot;genome_type&quot;]</span></code>).
Annotation should be done with tskit methods (e.g., <code class="docutils literal notranslate"><span class="pre">packset_metadata</span></code>).</p>
<p>.. note::</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Until pyslim version 0.600, the old-style metadata was still available,
but this functionality has been removed.
</pre></div>
</div>
<p>Here are more detailed notes on how to migrate a script from the legacy
metadata handling. If you run into issues, please ask (open a discussion on github).</p>
<p><strong>1.</strong> Use top-level metadata instead of <code class="docutils literal notranslate"><span class="pre">slim_provenance</span></code>:
previously, information about the model type and the time counter (generation)
in SLiM was provided in the Provenances table, made available through
the <code class="docutils literal notranslate"><span class="pre">ts.slim_provenance</span></code> object.  This is still available but deprecated,
and should be obtained from the <em>top-level</em> metadata object, <code class="docutils literal notranslate"><span class="pre">ts.metadata[&quot;SLiM&quot;]</span></code>.
So, in your scripts <code class="docutils literal notranslate"><span class="pre">ts.slim_provenance.model_type</span></code> should be replaced with
<code class="docutils literal notranslate"><span class="pre">ts.metadata[&quot;SLiM&quot;][&quot;model_type&quot;]</span></code>,
and (although it’s not deprecated), probably <code class="docutils literal notranslate"><span class="pre">ts.slim_generation</span></code> should
probably be replaced with
<code class="docutils literal notranslate"><span class="pre">ts.metadata[&quot;SLiM&quot;][&quot;generation&quot;]</span></code>.</p>
<p><strong>2.</strong> Switch metadata objects to dicts:
if <code class="docutils literal notranslate"><span class="pre">md</span></code> is the <code class="docutils literal notranslate"><span class="pre">metadata</span></code> property of a population, individual, or node,
this means replacing <code class="docutils literal notranslate"><span class="pre">md.X</span></code> with <code class="docutils literal notranslate"><span class="pre">md[&quot;X&quot;]</span></code>.
The <code class="docutils literal notranslate"><span class="pre">migration_records</span></code> property of population metadata is similarly
a list of dicts rather than a list of objects, so instead of
<code class="docutils literal notranslate"><span class="pre">ts.population(1).metadata.migration_records[0].source_subpop</span></code>
we would write
<code class="docutils literal notranslate"><span class="pre">ts.population(1).metadata[&quot;migration_records&quot;][0][&quot;source_subpop&quot;]</span></code>.</p>
<p>Mutations were previously a bit different - if <code class="docutils literal notranslate"><span class="pre">mut</span></code> is a mutation
(e.g., <code class="docutils literal notranslate"><span class="pre">mut</span> <span class="pre">=</span> <span class="pre">ts.mutation(0)</span></code>)
then <code class="docutils literal notranslate"><span class="pre">mut.metadata</span></code> was previously a list of MutationMetadata objects.
Now, <code class="docutils literal notranslate"><span class="pre">mut.metadata</span></code> is a dict, with a single entry:
<code class="docutils literal notranslate"><span class="pre">mut.metadata[&quot;mutation_list&quot;]</span></code> is a list of dicts, each containing the information
that was previously in the MutationMetadata objects.
So, for instance, instead of <code class="docutils literal notranslate"><span class="pre">mut.metadata[0].selection_coeff</span></code>
we would write <code class="docutils literal notranslate"><span class="pre">mut.metadata[&quot;mutation_list&quot;][0][&quot;selection_coeff&quot;]</span></code>.</p>
<p><strong>3.</strong> The <code class="docutils literal notranslate"><span class="pre">decode_X</span></code> and <code class="docutils literal notranslate"><span class="pre">encode_X</span></code> methods are now deprecated,
as this is handled by tskit itself.
For instance, <code class="docutils literal notranslate"><span class="pre">encode_node</span></code> would take a NodeMetadata object
and produce the raw bytes necessary to encode it in a Node table,
and <code class="docutils literal notranslate"><span class="pre">decode_node</span></code> would do the inverse operation.
This is now handled by the relevant MetadataSchema object:
for nodes one can obtain this as <code class="docutils literal notranslate"><span class="pre">nms</span> <span class="pre">=</span> <span class="pre">ts.tables.nodes.metadata_schema</span></code>,
which has the methods <code class="docutils literal notranslate"><span class="pre">nms.validate_and_encode_row</span></code> and <code class="docutils literal notranslate"><span class="pre">nms.decode_row</span></code>.
Decoding is for the most part not necessary,
since the metadata is automatically decoded,
but <code class="docutils literal notranslate"><span class="pre">pyslim.decode_node(raw_md)</span></code> could be replaced by <code class="docutils literal notranslate"><span class="pre">nms.decode_row(raw_md)</span></code>.
Encoding is necessary to modify tables,
and <code class="docutils literal notranslate"><span class="pre">pyslim.encode_node(md)</span></code> can be replaced by <code class="docutils literal notranslate"><span class="pre">nms.validate_and_encode_row(md)</span></code>
(where furthermore <code class="docutils literal notranslate"><span class="pre">md</span></code> should now be a dict rather than a NodeMetadata object).</p>
<p><strong>4.</strong> The <code class="docutils literal notranslate"><span class="pre">annotate_X_metadata</span></code> methods are deprecated,
as again tskit has tools to do this.
These methods would set the metadata column of a table -
for instance, if <code class="docutils literal notranslate"><span class="pre">metadata</span></code> is a list of NodeMetadata objects, then
<code class="docutils literal notranslate"><span class="pre">annotate_node_metadata(tables,</span> <span class="pre">metadata)</span></code> would modify <code class="docutils literal notranslate"><span class="pre">tables.nodes</span></code> in place
to contain the (encoded) metadata in the list <code class="docutils literal notranslate"><span class="pre">metadata</span></code>.
Now, this could be done as follows (where now <code class="docutils literal notranslate"><span class="pre">metadata</span></code> is a list of metadata dicts):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metadata</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span><span class="s1">&#39;slim_id&#39;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s1">&#39;is_vacant&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]}</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tables</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">num_rows</span><span class="p">)</span> <span class="p">]</span>
<span class="n">nms</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">metadata_schema</span>
<span class="n">tables</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">packset_metadata</span><span class="p">(</span>
  <span class="p">[</span><span class="n">nms</span><span class="o">.</span><span class="n">validate_and_encode_row</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If speed is an issue, then <code class="docutils literal notranslate"><span class="pre">encode_row</span></code> can be substituted for <code class="docutils literal notranslate"><span class="pre">validate_and_encode_row</span></code>,
but at the risk of missing errors in metadata.</p>
<p><strong>5.</strong> the <code class="docutils literal notranslate"><span class="pre">extract_X_metadata</span></code> methods are not necessary,
since the metadata in the tables of a TableCollection are automatically decoded.
For instance, <code class="docutils literal notranslate"><span class="pre">[ind.metadata[&quot;sex&quot;]</span> <span class="pre">for</span> <span class="pre">ind</span> <span class="pre">in</span> <span class="pre">tables.individuals]</span></code> will obtain
a list of sexes of the individuals in the IndividualTable.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It is our intention to remain backwards-compatible for a time.
However, the legacy code will disappear at some point in the future,
so please migrate over scripts you intend to rely on.</p>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="metadata.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Metadata</p>
      </div>
    </a>
    <a class="right-next"
       href="python_api.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Python API</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">1.1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">1.0</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">0.700</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#legacy-metadata">Legacy metadata</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Tskit Developers
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2021.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>