
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Topological analysis &#8212; Tskit manual</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5349f25f" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=9c3e77be" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/bespoke.css?v=00f581dd" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=1ae7504c"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'topological-analysis';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Identity by descent" href="ibd.html" />
    <link rel="prev" title="Statistics" href="stats.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <script data-goatcounter="https://tskit.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="introduction.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.svg" class="logo__image only-light" alt=""/>
    <script>document.write(`<img src="_static/logo.svg" class="logo__image only-dark" alt=""/>`);</script>
  
  
    <p class="title logo__title">Version 1.0.2.dev1</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Concepts</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-model.html">Data model</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="provenance.html">Provenance</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Analysis</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="stats.html">Statistics</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Topological analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="ibd.html">Identity by descent</a></li>
<li class="toctree-l1"><a class="reference internal" href="export.html">Data export</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Interfaces</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="python-api.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="numba.html">Numba Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="c-api.html">C API</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="file-formats.html">File formats</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">For developers</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelogs.html">Changelogs</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="citation.html">Citing tskit</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/tskit-dev/tskit" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/tskit-dev/tskit/edit/main/docs/topological-analysis.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/tskit-dev/tskit/issues/new?title=Issue%20on%20page%20%2Ftopological-analysis.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/topological-analysis.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Topological analysis</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visiting-nodes">Visiting nodes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#descendant-traversal">Descendant traversal</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#array-methods">Array methods</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ascending-traversal">Ascending traversal</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sec-combinatorics">Identifying and counting topologies</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpreting-tree-ranks">Interpreting Tree Ranks</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#enumerating-topologies">Enumerating Topologies</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#enumerating-tree-shapes">Enumerating Tree Shapes</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#labelling-tree-shapes">Labelling Tree Shapes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="topological-analysis">
<span id="sec-topological-analysis"></span><h1>Topological analysis<a class="headerlink" href="#topological-analysis" title="Link to this heading">#</a></h1>
<p>The branching structure of a tree is known as the tree <em>topology</em>. Dealing with the
topological structure of trees is of key importance in dealing with genealogies
such as those encoded in the tree sequence structure.</p>
<section id="visiting-nodes">
<span id="sec-topological-analysis-traversal"></span><h2>Visiting nodes<a class="headerlink" href="#visiting-nodes" title="Link to this heading">#</a></h2>
<section id="descendant-traversal">
<span id="sec-topological-analysis-descending"></span><h3>Descendant traversal<a class="headerlink" href="#descendant-traversal" title="Link to this heading">#</a></h3>
<p>A basic thing to want to do is to visit all the nodes in a tree under a focal node
(i.e. the focal node and all its descendants). This can be done in various
<em>traversal orders</em>. The <code class="docutils literal notranslate"><span class="pre">tskit</span></code> library provides several methods to do this, such
as <a class="reference internal" href="python-api.html#tskit.Tree.nodes" title="tskit.Tree.nodes"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Tree.nodes()</span></code></a> in the <a class="reference internal" href="python-api.html#sec-python-api"><span class="std std-ref">Python API</span></a>. By default, this method
iterates over all the descendant nodes of the root(s) of the tree, and hence
visits all the tree’s nodes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">tskit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">SVG</span><span class="p">,</span> <span class="n">display</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">tskit</span><span class="o">.</span><span class="n">Tree</span><span class="o">.</span><span class="n">generate_balanced</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">arity</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">SVG</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">()))</span>

<span class="k">for</span> <span class="n">order</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;preorder&quot;</span><span class="p">,</span> <span class="s2">&quot;inorder&quot;</span><span class="p">,</span> <span class="s2">&quot;postorder&quot;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">order</span><span class="si">}</span><span class="s2">:</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e4241f9dbc6fdaf2150ade6d68eae2762d212791789175bfe60673337ccf2a3e.svg" src="_images/e4241f9dbc6fdaf2150ade6d68eae2762d212791789175bfe60673337ccf2a3e.svg" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>preorder:	 [14, 10, 0, 1, 2, 11, 3, 4, 5, 13, 6, 7, 12, 8, 9]
inorder:	 [0, 10, 1, 2, 14, 3, 11, 4, 5, 6, 13, 7, 8, 12, 9]
postorder:	 [0, 1, 2, 10, 3, 4, 5, 11, 6, 7, 8, 9, 12, 13, 14]
</pre></div>
</div>
</div>
</div>
<p>Providing a focal node ID allows us to traverse through that node’s descendants.
For instance, here we visit node 13 and its descendants:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nodes under node 13:&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">u</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="mi">13</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nodes under node 13: [13, 6, 7, 12, 8, 9]
</pre></div>
</div>
</div>
</div>
<p>The node IDs returned by traversal methods allow us to to access node information.
Below, for example, we use the <a class="reference internal" href="python-api.html#tskit.Tree.num_children" title="tskit.Tree.num_children"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Tree.num_children()</span></code></a> method to find the number of
children (the “arity”) of every non-leaf node, and take the average. Since the
specific ordering of descendant nodes is not important in this case, we can leave
it out (defaulting to preorder traversal, the most efficient order):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">av_arity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">tree</span><span class="o">.</span><span class="n">num_children</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">tree</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">(</span><span class="n">u</span><span class="p">)])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average arity of internal nodes: </span><span class="si">{</span><span class="n">av_arity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average arity of internal nodes: 2.8
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In <code class="docutils literal notranslate"><span class="pre">tskit</span></code>, a tree can have multiple <a class="reference internal" href="data-model.html#sec-data-model-tree-roots"><span class="std std-ref">Roots</span></a>, each with a
descendant topology.  However, for some algorithms, instead of traversing through
the descendants of each root of a tree in turn, it can be helpful to start at a
single node and traverse downwards through the entire genealogy. The
<a class="reference internal" href="data-model.html#sec-data-model-tree-virtual-root"><span class="std std-ref">virtual root</span></a> is provided for this purpose.</p>
</div>
<section id="array-methods">
<h4>Array methods<a class="headerlink" href="#array-methods" title="Link to this heading">#</a></h4>
<p>The <a class="reference internal" href="python-api.html#tskit.Tree.nodes" title="tskit.Tree.nodes"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Tree.nodes()</span></code></a> iterator provides a convenient way of looping over descendant
node IDs, but it can be more efficient to deal with all the IDs at once, as a
single array of values. This can be combined with
<a class="reference internal" href="python-api.html#sec-python-api-trees-node-measures-array"><span class="std std-ref">direct memory access</span></a> resulting in a
high performance approach. Here, for example, is an equivalent
array-based method to find the average arity of internal nodes, by counting
how many times a node is referenced as a parent:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parent_id</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">parent_array</span><span class="p">[</span><span class="n">tree</span><span class="o">.</span><span class="n">preorder</span><span class="p">()],</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average arity is </span><span class="si">{</span><span class="n">count</span><span class="p">[</span><span class="n">parent_id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">tskit</span><span class="o">.</span><span class="n">NULL</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average arity is 2.8
</pre></div>
</div>
</div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>The <a class="reference external" href="https://tskit.dev/tutorials/analysing_trees.html#sec-analysing-trees" title="(in Project name not set)"><span>Analysing trees</span></a> tutorial provides a number of additional examples
of tree traversal techniques, with different performance characteristics.</p>
</div>
</section>
</section>
<section id="ascending-traversal">
<span id="sec-topological-analysis-ascending"></span><h3>Ascending traversal<a class="headerlink" href="#ascending-traversal" title="Link to this heading">#</a></h3>
<p>For many applications it is useful to be able to traverse upwards from a node or set
of nodes, such as the leaves. We can do this by iterating over parents. Here, for
example, we traverse upwards from each of the samples in the tree:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">samples</span><span class="p">():</span>
    <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">u</span>
    <span class="k">while</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">tskit</span><span class="o">.</span><span class="n">NULL</span><span class="p">:</span>
        <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">parent</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="s2">&quot;-&gt;&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0 -&gt; [0, 10, 14]
1 -&gt; [1, 10, 14]
2 -&gt; [2, 10, 14]
3 -&gt; [3, 11, 14]
4 -&gt; [4, 11, 14]
5 -&gt; [5, 11, 14]
6 -&gt; [6, 13, 14]
7 -&gt; [7, 13, 14]
8 -&gt; [8, 12, 13, 14]
9 -&gt; [9, 12, 13, 14]
</pre></div>
</div>
</div>
</div>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>Indicate that this can be made performant using <code class="docutils literal notranslate"><span class="pre">numba</span></code>, and link out to a tutorial
on high performance methods including the <code class="docutils literal notranslate"><span class="pre">numba</span></code> approach.</p>
</div>
</section>
</section>
<section id="sec-combinatorics">
<span id="identifying-and-counting-topologies"></span><h2>Identifying and counting topologies<a class="headerlink" href="#sec-combinatorics" title="Link to this heading">#</a></h2>
<p>tskit uses a combinatorial approach to identify unique topologies of
rooted, leaf-labelled trees. It provides methods
for enumerating all possible tree topologies, as well as converting
back and forth between a tree and its position, or rank, in the
enumeration of all possible topologies.
These methods do not only apply to binary trees;
rather, they cover general, rooted trees without unary nodes.</p>
<div class="pst-scrollable-table-container"><table class="table">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="python-api.html#tskit.Tree.rank" title="tskit.Tree.rank"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Tree.rank()</span></code></a></p></td>
<td><p>Return the rank of this tree.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="python-api.html#tskit.Tree.unrank" title="tskit.Tree.unrank"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Tree.unrank()</span></code></a></p></td>
<td><p>Return a Tree given its rank and a number of leaves.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="python-api.html#tskit.all_trees" title="tskit.all_trees"><code class="xref py py-func docutils literal notranslate"><span class="pre">tskit.all_trees()</span></code></a></p></td>
<td><p>Return a generator over all leaf-labelled trees of n leaves.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="python-api.html#tskit.all_tree_shapes" title="tskit.all_tree_shapes"><code class="xref py py-func docutils literal notranslate"><span class="pre">tskit.all_tree_shapes()</span></code></a></p></td>
<td><p>Return a generator over all tree shapes of n leaves.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="python-api.html#tskit.all_tree_labellings" title="tskit.all_tree_labellings"><code class="xref py py-func docutils literal notranslate"><span class="pre">tskit.all_tree_labellings()</span></code></a></p></td>
<td><p>Return a generator over all labellings of the given tree’s shape.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As the number of nodes increases, the number of different topologies rises
extremely rapidly (see its entry in the
<a class="reference external" href="https://oeis.org/A000311">On-Line Encyclopedia of Integer Sequences</a>). This
combinatorial explosion is a major limitation in any analysis that attempts to
explore possible topologies. For example, although the <a class="reference internal" href="python-api.html#tskit.all_trees" title="tskit.all_trees"><code class="xref py py-func docutils literal notranslate"><span class="pre">tskit.all_trees()</span></code></a>
function above will happily start generating topologies for (say) a tree of 50
leaves, the total number of possible topologies is over <span class="math notranslate nohighlight">\(6^81\)</span>, which is of
the same order as the number of atoms in the observable universe. Generating
all the topologies of a tree with anything much more than 10 tips is likely
to be impracticable.</p>
</div>
<section id="interpreting-tree-ranks">
<span id="sec-tree-ranks"></span><h3>Interpreting Tree Ranks<a class="headerlink" href="#interpreting-tree-ranks" title="Link to this heading">#</a></h3>
<p>To understand tree ranks we must look at how leaf-labelled tree topologies
are enumerated. For example, we can use <a class="reference internal" href="python-api.html#tskit.all_trees" title="tskit.all_trees"><code class="xref py py-func docutils literal notranslate"><span class="pre">tskit.all_trees()</span></code></a>
to generate all possible topologies of three leaves:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">tskit</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">SVG</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tskit</span><span class="o">.</span><span class="n">all_trees</span><span class="p">(</span><span class="n">num_leaves</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">display</span><span class="p">(</span><span class="n">SVG</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span><span class="n">node_labels</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;tree&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">120</span><span class="p">))))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/703405d140b7f6621c13dfe19128c413ba6415d657e08cd156d2262c69707a35.svg" src="_images/703405d140b7f6621c13dfe19128c413ba6415d657e08cd156d2262c69707a35.svg" />
<img alt="_images/c4499ee8c28c0e560b680b3fb7c3b98d43fa90d911725cc07d1ff9ae943c6a8f.svg" src="_images/c4499ee8c28c0e560b680b3fb7c3b98d43fa90d911725cc07d1ff9ae943c6a8f.svg" />
<img alt="_images/c8c9dda6a2077b357e4c16f2a7c768c8a05a4e889ab9c430b92cc1f30d3b2f7e.svg" src="_images/c8c9dda6a2077b357e4c16f2a7c768c8a05a4e889ab9c430b92cc1f30d3b2f7e.svg" />
<img alt="_images/31fa293ef274763f6ae74747c2ddce2565deba94f6836312beaba64c3c752538.svg" src="_images/31fa293ef274763f6ae74747c2ddce2565deba94f6836312beaba64c3c752538.svg" />
</div>
</div>
<p>In this sequence, there exist two distinct tree shapes and each shape
can be labelled in at least one unique way. Given that topologies are
ordered first by their shape and then by their labelling, a tree
topology can be uniquely identified by</p>
<ol class="arabic simple">
<li><p>The shape of the tree</p></li>
<li><p>The labelling of the tree’s shape</p></li>
</ol>
<p>We can refer to the first tree in the above enumeration as the
first labelling of the first shape of trees with three leaves, or tree
<span class="math notranslate nohighlight">\((0, 0)\)</span>. The second tree can be identified as the first labelling
of the second shape, or <span class="math notranslate nohighlight">\((1, 0)\)</span>, and so on.
This pair of indexes for the shape and labelling of a tree is referred
to as the rank of the tree, and can be computed using the
<a class="reference internal" href="python-api.html#tskit.Tree.rank" title="tskit.Tree.rank"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Tree.rank()</span></code></a> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ranks</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tskit</span><span class="o">.</span><span class="n">all_trees</span><span class="p">(</span><span class="n">num_leaves</span><span class="o">=</span><span class="mi">3</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ranks of 3-leaf trees:&quot;</span><span class="p">,</span> <span class="n">ranks</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ranks of 3-leaf trees: [Rank(shape=0, label=0), Rank(shape=1, label=0), Rank(shape=1, label=1), Rank(shape=1, label=2)]
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Ranks in combinatorics are typically natural numbers. However,
we refer to this tuple of shape and label rank as a rank because
it serves the same purpose of indexing trees in an enumeration.</p>
</div>
<p>For details on how shapes and labellings are ordered, see
<a class="reference internal" href="#sec-enumerating-topologies"><span class="std std-ref">Enumerating Topologies</span></a>.</p>
<p>We can also reconstruct a leaf-labelled tree given its rank. This process
is known as unranking, and can be performed using the <a class="reference internal" href="python-api.html#tskit.Tree.unrank" title="tskit.Tree.unrank"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Tree.unrank()</span></code></a>
method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]:</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">tskit</span><span class="o">.</span><span class="n">Tree</span><span class="o">.</span><span class="n">unrank</span><span class="p">(</span><span class="n">num_leaves</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="n">rank</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">SVG</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span><span class="n">node_labels</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;tree&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">120</span><span class="p">))))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/703405d140b7f6621c13dfe19128c413ba6415d657e08cd156d2262c69707a35.svg" src="_images/703405d140b7f6621c13dfe19128c413ba6415d657e08cd156d2262c69707a35.svg" />
<img alt="_images/c4499ee8c28c0e560b680b3fb7c3b98d43fa90d911725cc07d1ff9ae943c6a8f.svg" src="_images/c4499ee8c28c0e560b680b3fb7c3b98d43fa90d911725cc07d1ff9ae943c6a8f.svg" />
<img alt="_images/c8c9dda6a2077b357e4c16f2a7c768c8a05a4e889ab9c430b92cc1f30d3b2f7e.svg" src="_images/c8c9dda6a2077b357e4c16f2a7c768c8a05a4e889ab9c430b92cc1f30d3b2f7e.svg" />
<img alt="_images/31fa293ef274763f6ae74747c2ddce2565deba94f6836312beaba64c3c752538.svg" src="_images/31fa293ef274763f6ae74747c2ddce2565deba94f6836312beaba64c3c752538.svg" />
</div>
</div>
<section id="examples">
<h4>Examples<a class="headerlink" href="#examples" title="Link to this heading">#</a></h4>
<p>One application of tree ranks is to count the different
leaf-labelled topologies in a tree sequence. Since the ranks
are just tuples, we can use a Python <code class="docutils literal notranslate"><span class="pre">Counter</span></code> to track them.
Here, we count and unrank the most frequently seen
topology in a tree sequence. For brevity, this example assumes
samples are synonymous with leaves.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">collections</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">msprime</span>
<span class="c1"># Simulate a tree sequence with 2 diploid individuals (i.e. 4 samples)</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">msprime</span><span class="o">.</span><span class="n">sim_ancestry</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">sequence_length</span><span class="o">=</span><span class="mf">1e8</span><span class="p">,</span> <span class="n">recombination_rate</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">rank_counts</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">Counter</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ts</span><span class="o">.</span><span class="n">trees</span><span class="p">())</span>
<span class="n">most_freq_rank</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">rank_counts</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">most_freq_topology</span> <span class="o">=</span> <span class="n">tskit</span><span class="o">.</span><span class="n">Tree</span><span class="o">.</span><span class="n">unrank</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">most_freq_rank</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Most frequent topology&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">SVG</span><span class="p">(</span><span class="n">most_freq_topology</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span><span class="n">node_labels</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">3</span><span class="p">})))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Most frequent topology
</pre></div>
</div>
<img alt="_images/7c1d2c2abd9117cc44cb467c41d8a0c8e756c37dc7a9ae119829f93cc9252c56.svg" src="_images/7c1d2c2abd9117cc44cb467c41d8a0c8e756c37dc7a9ae119829f93cc9252c56.svg" />
</div>
</div>
</section>
</section>
<section id="enumerating-topologies">
<span id="sec-enumerating-topologies"></span><h3>Enumerating Topologies<a class="headerlink" href="#enumerating-topologies" title="Link to this heading">#</a></h3>
<p>This section expands briefly on the approach used to enumerate
tree topologies that serves as the basis for <a class="reference internal" href="python-api.html#tskit.Tree.rank" title="tskit.Tree.rank"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Tree.rank()</span></code></a>
and <a class="reference internal" href="python-api.html#tskit.Tree.unrank" title="tskit.Tree.unrank"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Tree.unrank()</span></code></a>.
To enumerate all rooted, leaf-labelled tree topologies, we first
formulate a system of ordering and enumerating tree shapes. Then
we define an enumeration of labellings given an arbitrary tree shape.</p>
<section id="enumerating-tree-shapes">
<h4>Enumerating Tree Shapes<a class="headerlink" href="#enumerating-tree-shapes" title="Link to this heading">#</a></h4>
<p>Starting with <span class="math notranslate nohighlight">\(n = 1\)</span>, we see that the only shape for a tree
with a single leaf is a single root leaf. A tree with <span class="math notranslate nohighlight">\(n &gt; 1\)</span>
leaves can be obtained by joining at least two trees whose number of
leaves sum to <span class="math notranslate nohighlight">\(n\)</span>.
This maps very closely to the concept of integer partitions.
Each tree shape of <span class="math notranslate nohighlight">\(n\)</span> leaves can be represented by taking a
nondecreasing integer partition of <span class="math notranslate nohighlight">\(n\)</span> (elements of the partition
are sorted in nondecreasing order) and recursively partitioning its
elements. The order in which we select partitions of <span class="math notranslate nohighlight">\(n\)</span> is
determined by the efficient
<a class="reference external" href="http://jeromekelleher.net/generating-integer-partitions.html">rule_asc</a>
algorithm for generating them.</p>
<p>All tree shapes with four leaves, and the partitions that generate
them, are:</p>
<img alt="All four-leaf tree shapes and their generating partitions" src="_images/four_leaf_tree_shapes.png" />
<p>Note that the middle column reflects all tree shapes of three leaves
in the right subtree!</p>
<p><code class="docutils literal notranslate"><span class="pre">*</span></code> This excludes the partition <span class="math notranslate nohighlight">\([n]\)</span>, since this would create a unary node
and trees with unary nodes are inumerable (and potentially infinite).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using nondecreasing integer partitions enforces a
<em>canonical orientation</em> on the tree shapes, where children under a node are
ordered by the number of leaves below them.
This is important because it prevents us from repeating trees that are
topologically the same but whose children are ordered differently.</p>
</div>
</section>
<section id="labelling-tree-shapes">
<h4>Labelling Tree Shapes<a class="headerlink" href="#labelling-tree-shapes" title="Link to this heading">#</a></h4>
<p>Tree shapes are useful in and of themselves, but we can use the enumeration
formulated above to go further and assign labels to the leaves of each shape.</p>
<p>Say we are given a tree <span class="math notranslate nohighlight">\(T\)</span> with <span class="math notranslate nohighlight">\(n\)</span> leaves, whose left-most
subtree, <span class="math notranslate nohighlight">\(T_l\)</span>, has <code class="docutils literal notranslate"><span class="pre">k</span></code> leaves. For each of the <span class="math notranslate nohighlight">\(n \choose k\)</span>
ways to select labels to assign to <span class="math notranslate nohighlight">\(T_l\)</span>, we produce a unique labelling
of <span class="math notranslate nohighlight">\(T\)</span>. This process of choosing labels is repeated for the other
children of <span class="math notranslate nohighlight">\(T\)</span> and then recursively for the subtrees.</p>
<p>Looking back to the example from <a class="reference internal" href="#sec-tree-ranks"><span class="std std-ref">Interpreting Tree Ranks</span></a>, we can see
the second tree shape, where the tree is a strictly bifucating tree of
three leaves, can be labelled in 3 different unique ways.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">second_tree</span> <span class="o">=</span> <span class="n">tskit</span><span class="o">.</span><span class="n">Tree</span><span class="o">.</span><span class="n">unrank</span><span class="p">(</span><span class="n">num_leaves</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tskit</span><span class="o">.</span><span class="n">all_tree_labellings</span><span class="p">(</span><span class="n">second_tree</span><span class="p">):</span>
    <span class="n">display</span><span class="p">(</span><span class="n">SVG</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">draw_svg</span><span class="p">(</span><span class="n">node_labels</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;tree&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">120</span><span class="p">))))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c4499ee8c28c0e560b680b3fb7c3b98d43fa90d911725cc07d1ff9ae943c6a8f.svg" src="_images/c4499ee8c28c0e560b680b3fb7c3b98d43fa90d911725cc07d1ff9ae943c6a8f.svg" />
<img alt="_images/c8c9dda6a2077b357e4c16f2a7c768c8a05a4e889ab9c430b92cc1f30d3b2f7e.svg" src="_images/c8c9dda6a2077b357e4c16f2a7c768c8a05a4e889ab9c430b92cc1f30d3b2f7e.svg" />
<img alt="_images/31fa293ef274763f6ae74747c2ddce2565deba94f6836312beaba64c3c752538.svg" src="_images/31fa293ef274763f6ae74747c2ddce2565deba94f6836312beaba64c3c752538.svg" />
</div>
</div>
<p>The order of the tree labellings is a direct result of the way in which
combinations of labels are chosen. The implementation in tskit uses a
standard lexicographic ordering to choose labels. See how the trees
are sorted by the order in which the left leaf’s label was chosen.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is a caveat here regarding symmetry, similar to that of repeating
tree shapes. Symmetrical trees run the risk of creating redundant labellings
if all combinations of labels were exhausted. To prevent redundant labellings
we impose a <em>canonical labelling</em>. In the case of two symmetrical subtrees,
the left subtree must receive the minimum label from the label set. Notice
how this is the case in the right subtrees above.</p>
</div>
<p>These two enumerations create a complete ordering of topologies where trees are
ordered first by size (number of leaves), then by shape, then by their minimum
label. It is this canonical order that enables efficient ranking and unranking
of topologies.</p>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="stats.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Statistics</p>
      </div>
    </a>
    <a class="right-next"
       href="ibd.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Identity by descent</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visiting-nodes">Visiting nodes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#descendant-traversal">Descendant traversal</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#array-methods">Array methods</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ascending-traversal">Ascending traversal</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sec-combinatorics">Identifying and counting topologies</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpreting-tree-ranks">Interpreting Tree Ranks</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#enumerating-topologies">Enumerating Topologies</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#enumerating-tree-shapes">Enumerating Tree Shapes</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#labelling-tree-shapes">Labelling Tree Shapes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Tskit Developers
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>